---
title: "Deconvolution with ABIS-seq"
author: "Sean Maden"
date: "2023-10-17"
output: html_document
---

```{r setup, include=FALSE}
libv <- c("ggplot2", "gridExtra")
sapply(libv, library, character.only = TRUE)
knitr::opts_chunk$set(echo = TRUE)
setwd("..")
setwd("..")
load("./env/02_abisseq/01_abisseq_script.RData")
```

Compare deconvolution results, with versus without scaling on cell size scale 
factors, using the ABIS-seq reference.

# Summaries

Flow cytometry proportions

```{r}
message("original:")
summary(df.wide$true.prop.mean.flow.cyto)
message("format:")
summary(df.wide$true.prop.mean.flow.cyto.format)
```

Predicted proportions

```{r}
message("scaled")
summary(df.tall$mean.scaled)
message("unscaled")
summary(df.tall$mean.unscaled)
```


# Plot

Scatterplots of mean predicted proportions, unscaled versus scaled

```{r}
plot1 <- ggplot(df.tall, aes(x = mean.unscaled, y = mean.scaled)) + 
  geom_point() + geom_smooth(method = "lm", se = F) +
  geom_abline(slope = 1, intercept = 0)
```

```{r}
plot2 <- ggplot(df.tall, aes(x = mean.unscaled, y = mean.scaled, size = s.cell.size.log)) + 
  geom_point() + geom_smooth(method = "lm", se = F) +
  geom_abline(slope = 1, intercept = 0)
```

```{r}
plot3 <- ggplot(df.tall, aes(x = mean.unscaled, y = mean.scaled, color = cell.type)) + 
  geom_point() + geom_smooth(method = "lm", se = F) +
  geom_abline(slope = 1, intercept = 0)
```

```{r}
plot4 <- ggplot(df.tall, aes(x = mean.unscaled, y = mean.scaled, 
                             color = cell.type, size = s.cell.size.log)) + 
  geom_point() + geom_smooth(method = "lm", se = F) +
  geom_abline(slope = 1, intercept = 0)
```

Multiplot scatter plots of unscaled versus scaled

```{r}
grid.arrange(plot1, plot2, plot3, plot4, nrow = 2)
```

Scatterplots of mean versus sd, predicted proportions

```{r}
ggplot(df.wide, aes(x = mean, y = sd)) + 
  geom_point() + geom_smooth(method = "lm", se = F) + facet_wrap(~type)
```

```{r}
ggplot(df.wide, aes(x = mean, y = sd)) + 
  geom_point(aes(color = cell.type)) + 
  geom_smooth(method = "lm", se = F) + facet_wrap(~type)
```

Scatterplot, true versus predicted proportions 

```{r}
ggplot(df.wide, aes(x = true.prop.mean.flow.cyto.format, y = mean, color = cell.type)) + 
  geom_point(size = 4, alpha = 0.5) + geom_abline(slope = 1, intercept = 0) +
  theme() + facet_wrap(~type) + xlab("True") + ylab("Predicted")
```

Boxplots and jittered points of errors

```{r}
ggplot(df.wide, aes(x = type, y = error.flow.cyto, color = cell.type)) +
  geom_jitter(alpha = 0.5, size = 4) + geom_boxplot(alpha = 0, color = "cyan") +
  theme() + xlab("Error") + ylab("Type")
```

# Save

```{r}
```

# Session info

```{r}
sessionInfo()
```

