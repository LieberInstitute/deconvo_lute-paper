% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={01\_transform},
  pdfauthor={Sean Maden},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{01\_transform}
\author{Sean Maden}
\date{2023-11-08}

\begin{document}
\maketitle

This notebook shows heatmaps of immune cell types before and after cell
type transformation. Part of this task is to relate the normalization
conditions to the discernability of cell type transformation difference.

\hypertarget{conditions-tested}{%
\section{Conditions tested}\label{conditions-tested}}

Experiment condition matrix for conditions evaluated.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{expressionScale=}\FunctionTok{c}\NormalTok{(}\StringTok{"tpm"}\NormalTok{, }\StringTok{"log2\_tpm\_plusone"}\NormalTok{, }\StringTok{"tpm"}\NormalTok{, }\StringTok{"log2\_tpm\_plusone"}\NormalTok{),}
  \AttributeTok{heatmapRescale=}\FunctionTok{rep}\NormalTok{(}\StringTok{"Z"}\NormalTok{, }\DecValTok{4}\NormalTok{),}
  \AttributeTok{cellSizeScaleFactor=}\FunctionTok{rep}\NormalTok{(}\StringTok{"sum"}\NormalTok{,}\DecValTok{4}\NormalTok{)}
\NormalTok{)}
\NormalTok{knitr}\SpecialCharTok{::}\FunctionTok{kable}\NormalTok{(df, }\AttributeTok{align =} \StringTok{"c"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ccc@{}}
\toprule\noalign{}
expressionScale & heatmapRescale & cellSizeScaleFactor \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
tpm & Z & sum \\
log2\_tpm\_plusone & Z & sum \\
tpm & Z & sum \\
log2\_tpm\_plusone & Z & sum \\
\end{longtable}

\hypertarget{heatmaps-tpm}{%
\section{Heatmaps TPM}\label{heatmaps-tpm}}

\hypertarget{before-transformation}{%
\subsection{Before transformation}\label{before-transformation}}

Showing the Z-transformed TPM scale marker expression for 17 cell types
from ABIS-seq reference. This is without the cell scale factors
transformation.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmapData }\OtherTok{\textless{}{-}}\NormalTok{ refTpmFilter}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmapTall }\OtherTok{\textless{}{-}} \FunctionTok{scale}\NormalTok{(heatmapData)}
\NormalTok{mapTable }\OtherTok{\textless{}{-}} \FunctionTok{mapTableImmuneCells}\NormalTok{(}\StringTok{"abis17"}\NormalTok{)}
\NormalTok{markerTable }\OtherTok{\textless{}{-}} \FunctionTok{markerTableFromList}\NormalTok{(listMarkers)}
\NormalTok{listMarkersHarmonize }\OtherTok{\textless{}{-}} \FunctionTok{markersHarmonize}\NormalTok{(heatmapTall, markerTable)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Found 72 duplicated markers.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmapTallHarmonized }\OtherTok{\textless{}{-}}\NormalTok{ listMarkersHarmonize[[}\StringTok{"heatmapTall"}\NormalTok{]]}
\NormalTok{markerTableHarmonized }\OtherTok{\textless{}{-}}\NormalTok{ listMarkersHarmonize[[}\StringTok{"markerTable"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newAnnotationHeatmapList }\OtherTok{\textless{}{-}} \FunctionTok{annotationHeatmapList}\NormalTok{(}
\NormalTok{  heatmapTallHarmonized, mapTable, markerTableHarmonized, }\StringTok{"Z"}\NormalTok{, }\StringTok{"Untransformed"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The automatically generated colors map from the 1^st and 99^th of the
## values in the matrix. There are outliers in the matrix whose patterns
## might be hidden by this color mapping. You can manually set the color
## to `col` argument.
## 
## Use `suppressMessages()` to turn off this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newAnnotationHeatmapList}\SpecialCharTok{$}\NormalTok{heatmap}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-7-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newAnnotationHeatmapListTpm }\OtherTok{\textless{}{-}}\NormalTok{ newAnnotationHeatmapList}
\end{Highlighting}
\end{Shaded}

\hypertarget{after-transformation}{%
\subsection{After transformation}\label{after-transformation}}

Showing the Z-transformed TPM scale marker expression for 17 cell types
from ABIS-seq reference. This is with the cell scale factors
transformation.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmapData }\OtherTok{\textless{}{-}}\NormalTok{ refTpmTransformedFilter}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmapTall }\OtherTok{\textless{}{-}} \FunctionTok{scale}\NormalTok{(heatmapData)}
\NormalTok{mapTable }\OtherTok{\textless{}{-}} \FunctionTok{mapTableImmuneCells}\NormalTok{(}\StringTok{"abis17"}\NormalTok{)}
\NormalTok{markerTable }\OtherTok{\textless{}{-}} \FunctionTok{markerTableFromList}\NormalTok{(listMarkers)}
\NormalTok{listMarkersHarmonize }\OtherTok{\textless{}{-}} \FunctionTok{markersHarmonize}\NormalTok{(heatmapTall, markerTable)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Found 72 duplicated markers.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmapTallHarmonized }\OtherTok{\textless{}{-}}\NormalTok{ listMarkersHarmonize[[}\StringTok{"heatmapTall"}\NormalTok{]]}
\NormalTok{markerTableHarmonized }\OtherTok{\textless{}{-}}\NormalTok{ listMarkersHarmonize[[}\StringTok{"markerTable"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newAnnotationHeatmapList }\OtherTok{\textless{}{-}} \FunctionTok{annotationHeatmapList}\NormalTok{(}
\NormalTok{  heatmapTallHarmonized, mapTable, markerTableHarmonized, }\StringTok{"Z"}\NormalTok{, }\StringTok{"Transformed"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The automatically generated colors map from the 1^st and 99^th of the
## values in the matrix. There are outliers in the matrix whose patterns
## might be hidden by this color mapping. You can manually set the color
## to `col` argument.
## 
## Use `suppressMessages()` to turn off this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newAnnotationHeatmapList}\SpecialCharTok{$}\NormalTok{heatmap}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-14-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newAnnotationHeatmapListTpmTransformed }\OtherTok{\textless{}{-}}\NormalTok{ newAnnotationHeatmapList}
\end{Highlighting}
\end{Shaded}

\hypertarget{side-by-side}{%
\subsection{Side-by-side}\label{side-by-side}}

Shows heatmaps before and after transformation, side by side.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmap1 }\OtherTok{\textless{}{-}}\NormalTok{ newAnnotationHeatmapListTpm}\SpecialCharTok{$}\NormalTok{heatmap}
\NormalTok{heatmap2 }\OtherTok{\textless{}{-}}\NormalTok{ newAnnotationHeatmapListTpmTransformed}\SpecialCharTok{$}\NormalTok{heatmap}
\NormalTok{heatmap1 }\SpecialCharTok{+}\NormalTok{ heatmap2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Heatmap/annotation names are duplicated: Z
\end{verbatim}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-16-1.pdf}

\hypertarget{heatmaps-log2-tpm-1}{%
\section{Heatmaps log2( TPM + 1 )}\label{heatmaps-log2-tpm-1}}

\hypertarget{before-transformation-1}{%
\subsection{Before transformation}\label{before-transformation-1}}

Showing the Z-transformed log2( TPM + 1 ) scale marker expression for 17
cell types from ABIS-seq reference. This is without the cell scale
factors transformation.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmapData }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(refTpmLog2Filter)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmapTall }\OtherTok{\textless{}{-}} \FunctionTok{scale}\NormalTok{(heatmapData)}
\NormalTok{mapTable }\OtherTok{\textless{}{-}} \FunctionTok{mapTableImmuneCells}\NormalTok{(}\StringTok{"abis17"}\NormalTok{)}
\NormalTok{markerTable }\OtherTok{\textless{}{-}} \FunctionTok{markerTableFromList}\NormalTok{(listMarkers)}
\NormalTok{listMarkersHarmonize }\OtherTok{\textless{}{-}} \FunctionTok{markersHarmonize}\NormalTok{(heatmapTall, markerTable)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Found 0 duplicated markers.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmapTallHarmonized }\OtherTok{\textless{}{-}}\NormalTok{ listMarkersHarmonize[[}\StringTok{"heatmapTall"}\NormalTok{]]}
\NormalTok{markerTableHarmonized }\OtherTok{\textless{}{-}}\NormalTok{ listMarkersHarmonize[[}\StringTok{"markerTable"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newAnnotationHeatmapList }\OtherTok{\textless{}{-}} \FunctionTok{annotationHeatmapList}\NormalTok{(}
\NormalTok{  heatmapTallHarmonized, mapTable, markerTableHarmonized, }\StringTok{"Z"}\NormalTok{, }\StringTok{"Untransformed"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newAnnotationHeatmapList}\SpecialCharTok{$}\NormalTok{heatmap}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-22-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newAnnotationHeatmapListTpmLog2Untransformed }\OtherTok{\textless{}{-}}\NormalTok{ newAnnotationHeatmapList}
\end{Highlighting}
\end{Shaded}

\hypertarget{after-transformation-1}{%
\subsection{After transformation}\label{after-transformation-1}}

Showing the Z-transformed log2( TPM + 1 ) scale marker expression for 17
cell types from ABIS-seq reference. This is with the cell scale factors
transformation.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmapData }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(refTpmLog2TransformedFilter)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmapTall }\OtherTok{\textless{}{-}} \FunctionTok{scale}\NormalTok{(heatmapData)}
\NormalTok{mapTable }\OtherTok{\textless{}{-}} \FunctionTok{mapTableImmuneCells}\NormalTok{(}\StringTok{"abis17"}\NormalTok{)}
\NormalTok{markerTable }\OtherTok{\textless{}{-}} \FunctionTok{markerTableFromList}\NormalTok{(listMarkers)}
\NormalTok{listMarkersHarmonize }\OtherTok{\textless{}{-}} \FunctionTok{markersHarmonize}\NormalTok{(heatmapTall, markerTable)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Found 0 duplicated markers.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmapTallHarmonized }\OtherTok{\textless{}{-}}\NormalTok{ listMarkersHarmonize[[}\StringTok{"heatmapTall"}\NormalTok{]]}
\NormalTok{markerTableHarmonized }\OtherTok{\textless{}{-}}\NormalTok{ listMarkersHarmonize[[}\StringTok{"markerTable"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newAnnotationHeatmapList }\OtherTok{\textless{}{-}} \FunctionTok{annotationHeatmapList}\NormalTok{(}
\NormalTok{  heatmapTallHarmonized, mapTable, markerTableHarmonized, }\StringTok{"Z"}\NormalTok{, }\StringTok{"Transformed"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newAnnotationHeatmapList}\SpecialCharTok{$}\NormalTok{heatmap}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-29-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newAnnotationHeatmapListTpmLog2Transformed }\OtherTok{\textless{}{-}}\NormalTok{ newAnnotationHeatmapList}
\end{Highlighting}
\end{Shaded}

\hypertarget{side-by-side-1}{%
\subsection{Side-by-side}\label{side-by-side-1}}

Shows heatmaps before and after transformation, side by side.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heatmap1 }\OtherTok{\textless{}{-}}\NormalTok{ newAnnotationHeatmapListTpmLog2Untransformed}\SpecialCharTok{$}\NormalTok{heatmap}
\NormalTok{heatmap2 }\OtherTok{\textless{}{-}}\NormalTok{ newAnnotationHeatmapListTpmLog2Transformed}\SpecialCharTok{$}\NormalTok{heatmap}
\NormalTok{heatmap1 }\SpecialCharTok{+}\NormalTok{ heatmap2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Heatmap/annotation names are duplicated: Z
\end{verbatim}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-31-1.pdf}

\hypertarget{scatter-plots}{%
\section{Scatter plots}\label{scatter-plots}}

Comparing before/after transformation expression

\hypertarget{tpm-expression}{%
\subsection{TPM expression}\label{tpm-expression}}

Scatterplots of marker TPM expression, comparing before and after
rescaling.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plotDataUntransformed }\OtherTok{\textless{}{-}}\NormalTok{ refTpmFilter}
\NormalTok{plotDataTransformed }\OtherTok{\textless{}{-}}\NormalTok{ refTpmTransformedFilter}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plotScatter }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{untransformed =}\NormalTok{ untransformedMelt[,}\StringTok{"value"}\NormalTok{],}
                          \AttributeTok{transformed =}\NormalTok{ transformedMelt[,}\StringTok{"value"}\NormalTok{],}
                          \AttributeTok{cellType =}\NormalTok{ untransformedMelt[,}\StringTok{"Var2"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

Overlay all cell types, markers.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(plotScatter, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ untransformed, }\AttributeTok{y =}\NormalTok{ transformed)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{intercept =} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-35-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(plotScatter, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ untransformed, }\AttributeTok{y =}\NormalTok{ transformed, }\AttributeTok{color =}\NormalTok{ cellType)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{intercept =} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-36-1.pdf}
Facet on cell types

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(plotScatter, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ untransformed, }\AttributeTok{y =}\NormalTok{ transformed)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{intercept =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{cellType)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-37-1.pdf}

Facet on cell types, excluding Plasmablasts.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(plotScatter[}\SpecialCharTok{!}\NormalTok{plotScatter}\SpecialCharTok{$}\NormalTok{cellType }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Plasmablasts"}\NormalTok{),], }
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ untransformed, }\AttributeTok{y =}\NormalTok{ transformed)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{intercept =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{cellType)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-38-1.pdf}

\hypertarget{log2tpm1-expression}{%
\subsection{log2(TPM+1) expression}\label{log2tpm1-expression}}

Scatterplots of marker log2(TPM+1) expression, comparing before and
after rescaling.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plotDataUntransformed }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(refTpmLog2Filter)}
\NormalTok{plotDataTransformed }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(refTpmLog2TransformedFilter)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plotScatter }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{untransformed =}\NormalTok{ untransformedMelt[,}\StringTok{"value"}\NormalTok{],}
                          \AttributeTok{transformed =}\NormalTok{ transformedMelt[,}\StringTok{"value"}\NormalTok{],}
                          \AttributeTok{cellType =}\NormalTok{ untransformedMelt[,}\StringTok{"Var2"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

Overlay all cell types, markers.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(plotScatter, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ untransformed, }\AttributeTok{y =}\NormalTok{ transformed)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{intercept =} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-42-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(plotScatter, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ untransformed, }\AttributeTok{y =}\NormalTok{ transformed, }\AttributeTok{color =}\NormalTok{ cellType)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{intercept =} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-43-1.pdf}

Facet on cell types

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(plotScatter, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ untransformed, }\AttributeTok{y =}\NormalTok{ transformed)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{intercept =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{cellType)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-44-1.pdf}

Facet on cell types, excluding Plasmablasts.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(plotScatter[}\SpecialCharTok{!}\NormalTok{plotScatter}\SpecialCharTok{$}\NormalTok{cellType }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Plasmablasts"}\NormalTok{),], }
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ untransformed, }\AttributeTok{y =}\NormalTok{ transformed)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{intercept =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{cellType)}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_transform_files/figure-latex/unnamed-chunk-45-1.pdf}

\hypertarget{session-info}{%
\section{Session info}\label{session-info}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 4.3.1 (2023-06-16 ucrt)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 11 x64 (build 22621)
## 
## Matrix products: default
## 
## 
## locale:
## [1] LC_COLLATE=English_United States.utf8 
## [2] LC_CTYPE=English_United States.utf8   
## [3] LC_MONETARY=English_United States.utf8
## [4] LC_NUMERIC=C                          
## [5] LC_TIME=English_United States.utf8    
## 
## time zone: America/Los_Angeles
## tzcode source: internal
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
## [1] reshape2_1.4.4        dplyr_1.1.3           ggplot2_3.4.4        
## [4] ComplexHeatmap_2.18.0
## 
## loaded via a namespace (and not attached):
##  [1] utf8_1.2.4          generics_0.1.3      shape_1.4.6        
##  [4] stringi_1.7.12      digest_0.6.33       magrittr_2.0.3     
##  [7] evaluate_0.23       RColorBrewer_1.1-3  iterators_1.0.14   
## [10] circlize_0.4.15     fastmap_1.1.1       foreach_1.5.2      
## [13] doParallel_1.0.17   plyr_1.8.9          GlobalOptions_0.1.2
## [16] fansi_1.0.5         scales_1.2.1        codetools_0.2-19   
## [19] cli_3.6.1           rlang_1.1.2         crayon_1.5.2       
## [22] munsell_0.5.0       withr_2.5.2         yaml_2.3.7         
## [25] tools_4.3.1         parallel_4.3.1      colorspace_2.1-0   
## [28] GetoptLong_1.0.5    BiocGenerics_0.48.1 vctrs_0.6.4        
## [31] R6_2.5.1            png_0.1-8           magick_2.8.1       
## [34] matrixStats_1.0.0   stats4_4.3.1        lifecycle_1.0.4    
## [37] stringr_1.5.0       S4Vectors_0.40.1    IRanges_2.36.0     
## [40] clue_0.3-65         cluster_2.1.4       pkgconfig_2.0.3    
## [43] pillar_1.9.0        gtable_0.3.4        glue_1.6.2         
## [46] Rcpp_1.0.11         highr_0.10          xfun_0.41          
## [49] tibble_3.2.1        tidyselect_1.2.0    rstudioapi_0.15.0  
## [52] knitr_1.45          farver_2.1.1        rjson_0.2.21       
## [55] htmltools_0.5.7     labeling_0.4.3      rmarkdown_2.25     
## [58] Cairo_1.6-1         compiler_4.3.1
\end{verbatim}

\end{document}
