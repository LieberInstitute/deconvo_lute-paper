rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$type=="withscale",], typeVector)
})
names(rmseK2Scale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
rmseK2Scale
df.k2
# SCALING
listRmseK2 <- list(
c("not.plasmablasts"), c("plasmablasts"), c("not.plasmablasts", "plasmablasts")
)
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$type=="scaled",], typeVector)
})
names(rmseK2Scale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
rmseK2Scale
listRmseK2
colnames(df.k2)
colnames(df.k2) <- c("NonPlasmablasts.pred", "Plasmablasts.pred",
"condition", "Plasmablasts.true", "NonPlasmablasts.true",
"sample.id")
head(df.k2)
rmseTableK2 <- function(df.k2, cohortLabel){
# rmseTable
# df.k2 table for k2 results
# cohortLabel dataset cohort label
#
# returns rmse table for k2 groups.
#
#-------------------
# calculations -- K2
#-------------------
# K2
# SCALING
listRmseK2 <- list(
c("NonPlasmablasts"), c("Plasmablasts"),
c("NonPlasmablasts", "Plasmablasts")
)
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$type=="scaled",], typeVector)
})
names(rmseK2Scale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
# NO SCALING
# SCALING
rmseK2Noscale <- lapply(listRmseK2, function(typeVector){
round(rmseType(df.k2[df.k2$type=="unscaled",], typeVector),3)
})
names(rmseK2Noscale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
#-----------
# SUPPLEMENT
#-----------
returnListScale <- list(c(rmseK2Scale))
returnTableScale <- do.call(cbind, lapply(seq(length(returnListScale)), function(ii){
c(names(returnListScale)[ii], returnListScale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnListNoscale <- list(c(rmseK2Noscale))
returnTableNoscale <- do.call(cbind, lapply(seq(length(returnListNoscale)), function(ii){
c(names(returnListNoscale)[ii], returnListNoscale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnTableScale$type <- "scale"
returnTableNoscale$type <- "noscale"
returnTable <- rbind(returnTableScale, returnTableNoscale)
colnames(returnTable)[1] <- "rmse"
returnTable$cohort <- cohortLabel
returnTable$numberCellTypes <- sapply(
rownames(returnTable), function(ii){
length(unlist(strsplit(ii, "\\.")))}) |> as.numeric()
return(returnTable)
}
supplementTable <- rmseTableK2(df.k2, "cohort3")
rmseTableK2 <- function(df.k2, cohortLabel){
# rmseTable
# df.k2 table for k2 results
# cohortLabel dataset cohort label
#
# returns rmse table for k2 groups.
#
#-------------------
# calculations -- K2
#-------------------
# K2
# SCALING
listRmseK2 <- list(
c("NonPlasmablasts"), c("Plasmablasts"),
c("NonPlasmablasts", "Plasmablasts")
)
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$type=="scaled",], typeVector)
})
names(rmseK2Scale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
# NO SCALING
# SCALING
rmseK2Noscale <- lapply(listRmseK2, function(typeVector){
round(rmseType(df.k2[df.k2$type=="unscaled",], typeVector),3)
})
names(rmseK2Noscale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
#-----------
# SUPPLEMENT
#-----------
returnListScale <- list(c(rmseK2Scale))
returnTableScale <- do.call(cbind, lapply(seq(length(returnListScale)), function(ii){
c(names(returnListScale)[ii], returnListScale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnListNoscale <- list(c(rmseK2Noscale))
returnTableNoscale <- do.call(cbind, lapply(seq(length(returnListNoscale)), function(ii){
c(names(returnListNoscale)[ii], returnListNoscale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnTableScale$type <- "scale"
returnTableNoscale$type <- "noscale"
returnTable <- rbind(returnTableScale, returnTableNoscale)
colnames(returnTable)[1] <- "rmse"
returnTable$cohort <- cohortLabel
returnTable$numberCellTypes <- sapply(
rownames(returnTable), function(ii){
length(unlist(strsplit(ii, "\\.")))}) |> as.numeric()
return(returnTable)
}
# rmseTable
# df.k2 table for k2 results
# cohortLabel dataset cohort label
#
# returns rmse table for k2 groups.
#
#-------------------
# calculations -- K2
#-------------------
# K2
# SCALING
listRmseK2 <- list(
c("NonPlasmablasts"), c("Plasmablasts"),
c("NonPlasmablasts", "Plasmablasts")
)
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$type=="scaled",], typeVector)
})
names(rmseK2Scale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
# NO SCALING
# SCALING
rmseK2Noscale <- lapply(listRmseK2, function(typeVector){
round(rmseType(df.k2[df.k2$type=="unscaled",], typeVector),3)
})
names(rmseK2Noscale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
#-----------
# SUPPLEMENT
#-----------
returnListScale <- list(c(rmseK2Scale))
returnTableScale <- do.call(cbind, lapply(seq(length(returnListScale)), function(ii){
c(names(returnListScale)[ii], returnListScale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnTableScale
load("env/08_improvement/02_simulation_script.RData")
df.k2 <- dfPseudobulk
colnames(df.k2) <- c("NonPlasmablasts.pred", "Plasmablasts.pred",
"condition", "Plasmablasts.true", "NonPlasmablasts.true",
"sample.id")
head(df.k2)
# rmse
rmseType <- function(df, type){
errorVector <- unlist(lapply(type, function(ti){
catchTrue <- grepl(ti,colnames(df))&grepl("\\.true$",colnames(df))
catchPred <- grepl(ti,colnames(df))&grepl("\\.pred$",colnames(df))
df[,catchTrue]-df[,catchPred]
})) |> as.numeric()
return(
sqrt(mean(errorVector^2))
)
}
# rmse
rmseType <- function(df, type){
errorVector <- unlist(lapply(type, function(ti){
catchTrue <- grepl(ti,colnames(df))&grepl("\\.true$",colnames(df))
catchPred <- grepl(ti,colnames(df))&grepl("\\.pred$",colnames(df))
df[,catchTrue]-df[,catchPred]
})) |> as.numeric()
return(
sqrt(mean(errorVector^2))
)
}
rmseTableK2 <- function(df.k2, cohortLabel){
# rmseTable
# df.k2 table for k2 results
# cohortLabel dataset cohort label
#
# returns rmse table for k2 groups.
#
#-------------------
# calculations -- K2
#-------------------
# K2
# SCALING
listRmseK2 <- list(
c("NonPlasmablasts"), c("Plasmablasts"),
c("NonPlasmablasts", "Plasmablasts")
)
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$type=="scaled",], typeVector)
})
names(rmseK2Scale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
# NO SCALING
# SCALING
rmseK2Noscale <- lapply(listRmseK2, function(typeVector){
round(rmseType(df.k2[df.k2$type=="unscaled",], typeVector),3)
})
names(rmseK2Noscale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
#-----------
# SUPPLEMENT
#-----------
returnListScale <- list(c(rmseK2Scale))
returnTableScale <- do.call(cbind, lapply(seq(length(returnListScale)), function(ii){
c(names(returnListScale)[ii], returnListScale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnListNoscale <- list(c(rmseK2Noscale))
returnTableNoscale <- do.call(cbind, lapply(seq(length(returnListNoscale)), function(ii){
c(names(returnListNoscale)[ii], returnListNoscale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnTableScale$type <- "scale"
returnTableNoscale$type <- "noscale"
returnTable <- rbind(returnTableScale, returnTableNoscale)
colnames(returnTable)[1] <- "rmse"
returnTable$cohort <- cohortLabel
returnTable$numberCellTypes <- sapply(
rownames(returnTable), function(ii){
length(unlist(strsplit(ii, "\\.")))}) |> as.numeric()
return(returnTable)
}
rmseTableK2
rmseTableK2(df.k2, "cohort3")
head(df.k2)
# SCALING
listRmseK2 <- list(
c("NonPlasmablasts"), c("Plasmablasts"),
c("NonPlasmablasts", "Plasmablasts")
)
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$type=="scaled",], typeVector)
})
names(rmseK2Scale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
# NO SCALING
# SCALING
rmseK2Noscale <- lapply(listRmseK2, function(typeVector){
round(rmseType(df.k2[df.k2$type=="unscaled",], typeVector),3)
})
names(rmseK2Noscale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
returnListScale <- list(c(rmseK2Scale))
returnTableScale <- do.call(cbind, lapply(seq(length(returnListScale)), function(ii){
c(names(returnListScale)[ii], returnListScale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnListNoscale <- list(c(rmseK2Noscale))
returnTableNoscale <- do.call(cbind, lapply(seq(length(returnListNoscale)), function(ii){
c(names(returnListNoscale)[ii], returnListNoscale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnTableScale$type <- "scale"
returnTableNoscale$type <- "noscale"
returnTable <- rbind(returnTableScale, returnTableNoscale)
returnTableScale
v
returnTableNoscale
returnListScale
rmseK2Scale
df.k2
typeVector = "Plasmablasts"
rmseType(df.k2[df.k2$type=="scaled",], typeVector)
df = df.k2
type = "Plasmablast"
type = "Plasmablasts"
errorVector <- unlist(lapply(type, function(ti){
catchTrue <- grepl(ti,colnames(df))&grepl("\\.true$",colnames(df))
catchPred <- grepl(ti,colnames(df))&grepl("\\.pred$",colnames(df))
df[,catchTrue]-df[,catchPred]
})) |> as.numeric()
errorVector
errorVector <- unlist(lapply(type, function(ti){
catchTrue <- grepl(ti,colnames(df))&grepl("\\.true$",colnames(df))
catchPred <- grepl(ti,colnames(df))&grepl("\\.pred$",colnames(df))
df[,catchTrue]-df[,catchPred]
})) |> as.numeric()
sqrt(mean(errorVector^2))
rmseType <- function(df, type){
errorVector <- unlist(lapply(type, function(ti){
catchTrue <- grepl(ti,colnames(df))&grepl("\\.true$",colnames(df))
catchPred <- grepl(ti,colnames(df))&grepl("\\.pred$",colnames(df))
df[,catchTrue]-df[,catchPred]
})) |> as.numeric()
return(
sqrt(mean(errorVector^2))
)
}
listRmseK2 <- list(
c("NonPlasmablasts"), c("Plasmablasts"),
c("NonPlasmablasts", "Plasmablasts")
)
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$type=="scaled",], typeVector)
})
rmseK2Scale
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$type=="scale",], typeVector)
})
rmseK2Scale
df.k2$condition
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$condition=="scale",], typeVector)
})
rmseK2Scale
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$condition=="scaled",], typeVector)
})
rmseK2Scale
listRmseK2 <- list(
c("NonPlasmablasts"), c("Plasmablasts"),
c("NonPlasmablasts", "Plasmablasts")
)
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$condition=="scaled",], typeVector)
})
rmseK2Scale
df.k2
head(df.k2)
# NO SCALING
# SCALING
rmseK2Noscale <- lapply(listRmseK2, function(typeVector){
round(rmseType(df.k2[df.k2$condition=="unscaled",], typeVector),3)
})
rmseK2Noscale
names(rmseK2Noscale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
rmseK2Noscale
# SCALING
listRmseK2 <- list(
c("NonPlasmablasts"), c("Plasmablasts"),
c("NonPlasmablasts", "Plasmablasts")
)
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$condition=="scaled",], typeVector)
})
rmseK2Scale
names(rmseK2Scale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
# NO SCALING
# SCALING
rmseK2Noscale <- lapply(listRmseK2, function(typeVector){
round(rmseType(df.k2[df.k2$condition=="unscaled",], typeVector),3)
})
names(rmseK2Noscale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
returnListScale <- list(c(rmseK2Scale))
returnTableScale <- do.call(cbind, lapply(seq(length(returnListScale)), function(ii){
c(names(returnListScale)[ii], returnListScale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnListNoscale <- list(c(rmseK2Noscale))
returnTableNoscale <- do.call(cbind, lapply(seq(length(returnListNoscale)), function(ii){
c(names(returnListNoscale)[ii], returnListNoscale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnTableScale
returnTableScale
returnTable$cohort <- cohortLabel
returnTable$numberCellTypes <- sapply(
rownames(returnTable), function(ii){
length(unlist(strsplit(ii, "\\.")))}) |> as.numeric()
returnTable
returnTableScale
returnTableScale
returnTableScale$type <- "scale"
returnTableNoscale$type <- "noscale"
returnTable <- rbind(returnTableScale, returnTableNoscale)
returnTableScale
returnTableNoscale
rbind(returnTableScale, returnTableNoscale)
returnListScale <- list(c(rmseK2Scale))
returnTableScale <- do.call(cbind, lapply(seq(length(returnListScale)), function(ii){
c(names(returnListScale)[ii], returnListScale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnListNoscale <- list(c(rmseK2Noscale))
returnTableNoscale <- do.call(cbind, lapply(seq(length(returnListNoscale)), function(ii){
c(names(returnListNoscale)[ii], returnListNoscale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnTableScale$type <- "scale"
returnTableNoscale$type <- "noscale"
returnTable <- rbind(returnTableScale, returnTableNoscale)
returnTable
returnListNoscale <- list(c(rmseK2Noscale))
returnTableNoscale <- do.call(cbind, lapply(seq(length(returnListNoscale)), function(ii){
c(names(returnListNoscale)[ii], returnListNoscale[[ii]])
})) |> as.data.frame()
returnTableNoscale$k <- c(rep("k2", length(listRmseK2)))
returnTableScale$type <- "scale"
returnTableNoscale$type <- "noscale"
returnTable <- rbind(returnTableScale, returnTableNoscale)
colnames(returnTable)[1] <- "rmse"
returnTable
rmseTableK2 <- function(df.k2, cohortLabel){
# rmseTable
# df.k2 table for k2 results
# cohortLabel dataset cohort label
#
# returns rmse table for k2 groups.
#
#-------------------
# calculations -- K2
#-------------------
# K2
# SCALING
listRmseK2 <- list(
c("NonPlasmablasts"), c("Plasmablasts"),
c("NonPlasmablasts", "Plasmablasts")
)
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$condition=="scaled",], typeVector)
})
rmseK2Scale
names(rmseK2Scale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
# NO SCALING
# SCALING
rmseK2Noscale <- lapply(listRmseK2, function(typeVector){
round(rmseType(df.k2[df.k2$condition=="unscaled",], typeVector),3)
})
names(rmseK2Noscale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
#-----------
# SUPPLEMENT
#-----------
returnListScale <- list(c(rmseK2Scale))
returnTableScale <- do.call(cbind, lapply(seq(length(returnListScale)), function(ii){
c(names(returnListScale)[ii], returnListScale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnListNoscale <- list(c(rmseK2Noscale))
returnTableNoscale <- do.call(cbind, lapply(seq(length(returnListNoscale)), function(ii){
c(names(returnListNoscale)[ii], returnListNoscale[[ii]])
})) |> as.data.frame()
returnTableNoscale$k <- c(rep("k2", length(listRmseK2)))
returnTableScale$type <- "scale"
returnTableNoscale$type <- "noscale"
returnTable <- rbind(returnTableScale, returnTableNoscale)
colnames(returnTable)[1] <- "rmse"
returnTable$cohort <- cohortLabel
returnTable$numberCellTypes <- sapply(
rownames(returnTable), function(ii){
length(unlist(strsplit(ii, "\\.")))}) |> as.numeric()
return(returnTable)
}
#----------------
# make rmse table
#----------------
supplementTable <- rmseTableK2(df.k2, "cohort3")
supplementTable
rmseTableK2 <- function(df.k2, cohortLabel){
# rmseTable
# df.k2 table for k2 results
# cohortLabel dataset cohort label
#
# returns rmse table for k2 groups.
#
#-------------------
# calculations -- K2
#-------------------
# K2
# SCALING
listRmseK2 <- list(
c("NonPlasmablasts"), c("Plasmablasts"),
c("NonPlasmablasts", "Plasmablasts")
)
rmseK2Scale <- lapply(listRmseK2, function(typeVector){
rmseType(df.k2[df.k2$condition=="scaled",], typeVector)
})
rmseK2Scale
names(rmseK2Scale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
# NO SCALING
# SCALING
rmseK2Noscale <- lapply(listRmseK2, function(typeVector){
round(rmseType(df.k2[df.k2$condition=="unscaled",], typeVector),3)
})
names(rmseK2Noscale) <- sapply(listRmseK2, function(i){paste0(i,collapse =";")})
#-----------
# SUPPLEMENT
#-----------
returnListScale <- list(c(rmseK2Scale))
returnTableScale <- do.call(cbind, lapply(seq(length(returnListScale)), function(ii){
c(names(returnListScale)[ii], returnListScale[[ii]])
})) |> as.data.frame()
returnTableScale$k <- c(rep("k2", length(listRmseK2)))
returnListNoscale <- list(c(rmseK2Noscale))
returnTableNoscale <- do.call(cbind, lapply(seq(length(returnListNoscale)), function(ii){
c(names(returnListNoscale)[ii], returnListNoscale[[ii]])
})) |> as.data.frame()
returnTableNoscale$k <- c(rep("k2", length(listRmseK2)))
returnTableScale$type <- "scale"
returnTableNoscale$type <- "noscale"
returnTable <- rbind(returnTableScale, returnTableNoscale)
colnames(returnTable)[1] <- "rmse"
returnTable$cohort <- cohortLabel
returnTable$numberCellTypes <- sapply(
rownames(returnTable), function(ii){
length(unlist(strsplit(ii, "\\;")))}) |> as.numeric()
return(returnTable)
}
rmseTableK2(df.k2, "cohort3")
# save
save(supplementTable, file = "./outputs/08_improvements/rmse_supplementTable.rda")
#-----
# save
#-----
# save
save(supplementTable, file = "./outputs/08_improvements/rmse_supplementTable.rda")
