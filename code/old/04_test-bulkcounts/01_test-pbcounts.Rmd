---
title: "01_test-pbcounts"
author: "Sean Maden"
date: '2022-10-20'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(ComplexHeatmap)
#-----
# load
#-----
source(file.path(here(), "deconvo_method-paper", "source", "load_pb_demo.R"))
```

This demo looks at the results of performing pseudobulking where the scale of the 
convoluted signals differs from that of the signature matrix (e.g. where Y consists 
of counts rather than mean ratios).

Note, we take $Y = \pi * Z$ as our representation of the deconvolution model.

# Assumptions

Suppose K = 4.

## Representation of the problem

If we have that $Y = \pi * Z$

We might say that we have $Z' = F_{Z}$ where $F_{Z}$ is some series of transformation functions such as $R(L(C))$ or perhaps $R \arrow L \arrow C$, where $R$ is the mean ratio function, $L$ is some log function, and $C$ is conuts.

So we might say that $Z' = Z' * F_{Z}$ where $F_{Z}$ is some function to transform the $Z$ signature matrix.

However we can't in practice, do $Y * F_{Z} = \pi * Z * F_{Z}$ for many reasons. First, $F_{Z}$ may require prior knowledge of the cell abundances. Second, $Y$ may be produced from an entirely different data source than $Z$, (such as a non-complementary dataset, some different sequencing platform, etc.). Independent of these issues, we also have the issue of lack of "fidelity" or lack of counts for $Y$ and $Z$, and this is especially important for understanding abundances of sparse/rare/low-count cell types in the context of heterogeneous tissues (e.g. tissue containing *both* sparse and not-sparse cell types).

## Issues with $Y$

Say we have that $Y * F_{Y} = Y'$

We may think we then have that $Y' = Y * F_{Y} = \pi * Z * F_{Y}$

But in practice, we cannot do this because, again, we 

(1) lack prior knowledge of cell type abundances, and 
(2) $Z$ and $Y$ may be from different data sources or platforms 

## The signature matrix $Z$

# section

```{r}
```



























