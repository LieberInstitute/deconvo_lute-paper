geom_text(data = dfLabelNeuron, aes(x = true, y = value),
label = sample.id, nudge_x = 0.1, nudge_y = 0.1) +
geom_text(data = dfLabelGlial, aes(x = true, y = value),
label = sample.id, nudge_x = 0.1, nudge_y = 0.1)
}
jitterbox <- ggplot(dfp[dfp$cell.type == "neuron",], aes(x = scale, y = error)) +
geom_jitter(alpha = 0.5, width = 0.5, height = 0) + theme_bw() +
geom_boxplot(alpha = 0, color = "cyan") +
xlab("Scale") + ylab("Error") + ylim(0, 0.5) +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank())
return(list(
newPlot, jitterbox
))
}
plotsListNNLS <- plotsList(dfp.tall[dfp.tall$algorithm=="nnls",])
plotsListMUSIC <- plotsList(dfp.tall[dfp.tall$algorithm=="music",])
plotsListBISQUE <- plotsList(dfp.tall[dfp.tall$algorithm=="bisque",], outlier = FALSE)
setwd("..")
setwd("..")
jpeg("./figures/07_adjustment/fig3_bulk-results_nnls.jpg",
width = 6, height = 4, units = "in", res = 400)
grid.arrange(plotsListNNLS[[1]], plotsListNNLS[[2]],
layout_matrix = matrix(c(1,1,2), byrow=TRUE, nrow = 1))
dev.off()
setwd("..")
setwd("..")
jpeg("./figures/07_adjustment/fig3_bulk-results_music-bisque.jpg",
width = 5.5, height = 8, units = "in", res = 400)
grid.arrange(plotsListMUSIC[[1]] + ggtitle("MuSiC"), plotsListMUSIC[[2]] + ggtitle(""),
plotsListBISQUE[[1]] + ggtitle("Bisque"), plotsListBISQUE[[2]] + ggtitle(""),
layout_matrix = matrix(c(1,1,2,3,3,4), byrow = TRUE, nrow = 2))
dev.off()
# append glial
dfp.tall2 <- dfp.tall
dfp.tall2$cell.type <- "glial"
dfp.tall2$value <- 1-dfp.tall2$value
dfp.tall2$true <- 1-dfp.tall2$true
dfp.tall <- rbind(dfp.tall, dfp.tall2) |> as.data.frame()
plotsList <- function(dfp, outlier = TRUE){
# plotsList
#
# scatterplot and jitterbox plot of results data, with outlier label.
#
# dfp.tall results data.frame
#
#
#
#
dfp$scale <- ifelse(dfp$scale, "withscale", "noscale")
newPlot <- ggplot(dfp, aes(x = true, y = value)) +
geom_point(size = 4, alpha = 0.5) +
geom_abline(slope = 1, intercept = 0) +
facet_grid(cell.type~scale, nrow = 2) + xlab("Known") +
ylab("Predicted") + theme_bw() + xlim(0, 1) + ylim(0, 1) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
if(outlier){
dfLabelGlial <- dfp[dfp$value > 0.75 & dfp$cell.type == "glial",]
dfLabelNeuron <- dfp[dfp$value < 0.25 &
dfp$true < 0.75 & dfp$cell.type == "neuron",]
newPlot <- newPlot +
geom_text(data = dfLabelNeuron, aes(x = true, y = value),
label = sample.id, nudge_x = 0.1, nudge_y = 0.1) +
geom_text(data = dfLabelGlial, aes(x = true, y = value),
label = sample.id, nudge_x = 0.1, nudge_y = 0.1)
}
jitterbox <- ggplot(dfp[dfp$cell.type == "neuron",], aes(x = scale, y = error)) +
geom_jitter(alpha = 0.5, width = 0.5, height = 0) + theme_bw() +
geom_boxplot(alpha = 0, color = "cyan") +
xlab("Scale") + ylab("Error") + ylim(0, 0.5) +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank())
return(list(
newPlot, jitterbox
))
}
plotsListNNLS <- plotsList(dfp.tall[dfp.tall$algorithm=="nnls",])
setwd("..")
setwd("..")
jpeg("./figures/07_adjustment/fig3_bulk-results_nnls.jpg",
width = 6, height = 4, units = "in", res = 400)
grid.arrange(plotsListNNLS[[1]], plotsListNNLS[[2]],
layout_matrix = matrix(c(1,1,2), byrow=TRUE, nrow = 1))
dev.off()
setwd("..")
setwd("..")
jpeg("./figures/07_adjustment/fig3_bulk-results_music-bisque.jpg",
width = 5.5, height = 8, units = "in", res = 400)
grid.arrange(plotsListMUSIC[[1]] + ggtitle("MuSiC"), plotsListMUSIC[[2]] + ggtitle(""),
plotsListBISQUE[[1]] + ggtitle("Bisque"), plotsListBISQUE[[2]] + ggtitle(""),
layout_matrix = matrix(c(1,1,2,3,3,4), byrow = TRUE, nrow = 2))
dev.off()
plotsListNNLS[[1]]
plotsListNNLS <- plotsList(dfp.tall[dfp.tall$algorithm=="nnls",])
plotsList <- function(dfp, outlier = TRUE){
# plotsList
#
# scatterplot and jitterbox plot of results data, with outlier label.
#
# dfp.tall results data.frame
#
#
#
#
dfp$scale <- ifelse(dfp$scale, "withscale", "noscale")
newPlot <- ggplot(dfp, aes(x = true, y = value)) +
geom_point(size = 4, alpha = 0.5) +
geom_abline(slope = 1, intercept = 0) +
facet_grid(cell.type~scale) + xlab("Known") +
ylab("Predicted") + theme_bw() + xlim(0, 1) + ylim(0, 1) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
if(outlier){
dfLabelGlial <- dfp[dfp$value > 0.75 & dfp$cell.type == "glial",]
dfLabelNeuron <- dfp[dfp$value < 0.25 &
dfp$true < 0.75 & dfp$cell.type == "neuron",]
newPlot <- newPlot +
geom_text(data = dfLabelNeuron, aes(x = true, y = value),
label = sample.id, nudge_x = 0.1, nudge_y = 0.1) +
geom_text(data = dfLabelGlial, aes(x = true, y = value),
label = sample.id, nudge_x = 0.1, nudge_y = 0.1)
}
jitterbox <- ggplot(dfp[dfp$cell.type == "neuron",], aes(x = scale, y = error)) +
geom_jitter(alpha = 0.5, width = 0.5, height = 0) + theme_bw() +
geom_boxplot(alpha = 0, color = "cyan") +
xlab("Scale") + ylab("Error") + ylim(0, 0.5) +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank())
return(list(
newPlot, jitterbox
))
}
plotsListNNLS <- plotsList(dfp.tall[dfp.tall$algorithm=="nnls",])
plotsListMUSIC <- plotsList(dfp.tall[dfp.tall$algorithm=="music",])
plotsListBISQUE <- plotsList(dfp.tall[dfp.tall$algorithm=="bisque",], outlier = FALSE)
grid.arrange(plotsListNNLS[[1]], plotsListNNLS[[2]],
layout_matrix = matrix(c(1,1,2), byrow=TRUE, nrow = 1))
gc()
gc()
knitr::opts_chunk$set(echo = TRUE)
libv <- c("dplyr", "ggplot2", "GGally", "gridExtra")
sapply(libv, library, character.only = TRUE)
setwd("..")
setwd("..")
load("./env/07_adjustment/03_run_adjustment_realbulk_all_script.RData")
list.df.true <- metadata(sce)[["list.df.true.k2"]]
plotsList <- function(dfp){
# plotsList
#
# scatterplot and jitterbox plot of results data, with outlier label.
#
# dfp.tall results data.frame
#
#
dfp$scale <- ifelse(dfp$scale, "withscale", "noscale")
dfLabel <- dfp[dfp$true < 0.75 & dfp$value < 0.25,]
new.plot.tall <- ggplot(dfp, aes(x = true, y = value)) +
geom_point(size = 4, alpha = 0.5) + geom_abline(slope = 1, intercept = 0) + facet_wrap(~scale) +
xlab("Known") + ylab("Predicted") + xlim(0.1,0.9) + ylim(0.1,0.9) + theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
geom_text(data = dfLabel, aes(x = true, y = value),
label = sample.id, nudge_x = 0.1, nudge_y = 0.1)
new.plot.tall
new.plot.tall.jitterbox <- ggplot(dfp, aes(x = scale, y = error)) +
geom_jitter(alpha = 0.5, width = 0.5, height = 0) + theme_bw() +
geom_boxplot(alpha = 0, color = "cyan") +
xlab("Scale") + ylab("Error (neuron)") + ylim(0, 0.5) +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank())
new.plot.tall.jitterbox
return(list(
new.plot.tall, new.plot.tall.jitterbox
))
}
list.df.true <- metadata(sce)[["list.df.true.k2"]]
for(sample.id in unique(dfp.tall$sample.id)){
message(sample.id)
message(identical(dfp.tall[dfp.tall$sample.id==sample.id,]$true[1],
as.numeric(list.df.true[[sample.id]]["neuron"])))
}
for(sample.id in unique(dfp.tall$sample.id)){
filter.dfp.tall <- dfp.tall$sample.id==sample.id
filter.dfp.wide <- rownames(dfp.wide)==sample.id
true.neuron.value <- as.numeric(df.true.list[[sample.id]]["neuron"])
dfp.tall[filter.dfp.tall,]$true <- true.neuron.value
dfp.wide[filter.dfp.wide,]$neuron.true <- true.neuron.value
}
dfp.tall$error <- abs(dfp.tall$true-dfp.tall$value)
new.plot.tall.jitterbox <- ggplot(dfp.tall,
aes(x = scale, y = error)) +
geom_jitter(alpha = 0.5, width = 0.5, height = 0) + geom_boxplot(alpha = 0, color = "cyan") +
facet_wrap(~algorithm) + xlab("Scale") +
ylab("Error (neuron)") + ylim(0, 0.5) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
new.plot.tall.jitterbox
# append glial
dfp.tall2 <- dfp.tall
dfp.tall2$cell.type <- "glial"
dfp.tall2$value <- 1-dfp.tall2$value
dfp.tall2$true <- 1-dfp.tall2$true
dfp.tall <- rbind(dfp.tall, dfp.tall2) |> as.data.frame()
plotsList <- function(dfp, outlier = TRUE){
# plotsList
#
# scatterplot and jitterbox plot of results data, with outlier label.
#
# dfp.tall results data.frame
#
#
#
#
dfp$scale <- ifelse(dfp$scale, "withscale", "noscale")
newPlot <- ggplot(dfp, aes(x = true, y = value)) +
geom_point(size = 4, alpha = 0.5) +
geom_abline(slope = 1, intercept = 0) +
facet_grid(cell.type~scale) + xlab("Known") +
ylab("Predicted") + theme_bw() + xlim(0, 1) + ylim(0, 1) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
if(outlier){
dfLabelGlial <- dfp[dfp$value > 0.75 & dfp$cell.type == "glial",]
dfLabelNeuron <- dfp[dfp$value < 0.25 &
dfp$true < 0.75 & dfp$cell.type == "neuron",]
newPlot <- newPlot +
geom_text(data = dfLabelNeuron, aes(x = true, y = value),
label = sample.id, nudge_x = 0.1, nudge_y = 0.1) +
geom_text(data = dfLabelGlial, aes(x = true, y = value),
label = sample.id, nudge_x = 0.1, nudge_y = 0.1)
}
jitterbox <- ggplot(dfp[dfp$cell.type == "neuron",], aes(x = scale, y = error)) +
geom_jitter(alpha = 0.5, width = 0.5, height = 0) + theme_bw() +
geom_boxplot(alpha = 0, color = "cyan") +
xlab("Scale") + ylab("Error") + ylim(0, 0.5) +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank())
return(list(
newPlot, jitterbox
))
}
plotsListNNLS <- plotsList(dfp.tall[dfp.tall$algorithm=="nnls",])
plotsListMUSIC <- plotsList(dfp.tall[dfp.tall$algorithm=="music",])
plotsListBISQUE <- plotsList(dfp.tall[dfp.tall$algorithm=="bisque",], outlier = FALSE)
setwd("..")
setwd("..")
jpeg("./figures/07_adjustment/fig3_bulk-results_nnls.jpg",
width = 6, height = 4, units = "in", res = 400)
grid.arrange(plotsListNNLS[[1]], plotsListNNLS[[2]],
layout_matrix = matrix(c(1,1,2), byrow=TRUE, nrow = 1))
dev.off()
setwd("..")
setwd("..")
jpeg("./figures/07_adjustment/fig3_bulk-results_music-bisque.jpg",
width = 5.5, height = 8, units = "in", res = 400)
grid.arrange(plotsListMUSIC[[1]] + ggtitle("MuSiC"), plotsListMUSIC[[2]] + ggtitle(""),
plotsListBISQUE[[1]] + ggtitle("Bisque"), plotsListBISQUE[[2]] + ggtitle(""),
layout_matrix = matrix(c(1,1,2,3,3,4), byrow = TRUE, nrow = 2))
dev.off()
setwd("C:/Users/User/Documents/GitHub/deconvo_method-paper/software")
libv <- c("here", "nlme", "lute", "ggplot2", "gridExtra",
"dplyr", "ggforce", "MultiAssayExperiment", "SingleCellExperiment")
sapply(libv, library, character.only = TRUE)
knitr::opts_chunk$set(echo = TRUE)
setwd("..")
setwd("..")
list.files()
load("env/01_multipanel/01_pseudobulk_script.RData")
# cohort 1
# scatter with facet
dfp.c1 <- rbind(data.frame(true = dfp.tall.c1.k2$glial.true,
pred = dfp.tall.c1.k2$glial.pred,
cell.type = rep("glial", nrow(dfp.tall.c1.k2)),
type = dfp.tall.c1.k2$type,
error = dfp.tall.c1.k2$glial.abs.error),
data.frame(true = dfp.tall.c1.k2$neuron.true,
pred = dfp.tall.c1.k2$neuron.pred,
cell.type = rep("neuron", nrow(dfp.tall.c1.k2)),
type = dfp.tall.c1.k2$type,
error = dfp.tall.c1.k2$neuron.abs.error)) |>
as.data.frame()
plotK2.scatter.c1 <- ggplot(dfp.c1, aes(x = true, y = pred)) +
geom_point() + theme_bw() + geom_abline(slope = 1) +
theme(axis.text.x = element_text(angle = 45, hjust=1)) +
xlab("Known") + ylab("Predicted") + ggtitle("Huuki-Meyers et. al. 2023") +
xlim(0,1) + ylim(0,1) +
facet_grid(type+cell.type)
# cohort 1
# scatter with facet
dfp.c1 <- rbind(data.frame(true = dfp.tall.c1.k2$glial.true,
pred = dfp.tall.c1.k2$glial.pred,
cell.type = rep("glial", nrow(dfp.tall.c1.k2)),
type = dfp.tall.c1.k2$type,
error = dfp.tall.c1.k2$glial.abs.error),
data.frame(true = dfp.tall.c1.k2$neuron.true,
pred = dfp.tall.c1.k2$neuron.pred,
cell.type = rep("neuron", nrow(dfp.tall.c1.k2)),
type = dfp.tall.c1.k2$type,
error = dfp.tall.c1.k2$neuron.abs.error)) |>
as.data.frame()
plotK2.scatter.c1 <- ggplot(dfp.c1, aes(x = true, y = pred)) +
geom_point() + theme_bw() + geom_abline(slope = 1) +
theme(axis.text.x = element_text(angle = 45, hjust=1)) +
xlab("Known") + ylab("Predicted") + ggtitle("Huuki-Meyers et. al. 2023") +
xlim(0,1) + ylim(0,1) +
facet_grid(type~cell.type)
plotK2.box.c1 <- ggplot(dfp.c1, aes(x = type, y = error)) +
geom_boxplot(color="cyan") + geom_jitter(alpha = 0.5) + theme_bw() +
theme(axis.text.x = element_text(angle = 45,hjust=1), axis.title.x = element_blank()) +
ylab("Error") + ggtitle("\n") + ylim(0, 0.3) + facet_wrap(~cell.type, nrow = 2)
# cohort 2
# scatter with facet
dfp.c2 <- rbind(data.frame(true = dfp.tall.c2.k2$glial.true,
pred = dfp.tall.c2.k2$glial.pred,
cell.type = rep("glial", nrow(dfp.tall.c2.k2)),
type = dfp.tall.c2.k2$type,
error = dfp.tall.c2.k2$glial.abs.error),
data.frame(true = dfp.tall.c2.k2$neuron.true,
pred = dfp.tall.c2.k2$neuron.pred,
cell.type = rep("neuron", nrow(dfp.tall.c2.k2)),
type = dfp.tall.c2.k2$type,
error = dfp.tall.c2.k2$neuron.abs.error)) |>
as.data.frame()
plotK2.scatter.c2 <- ggplot(dfp.c2, aes(x = true, y = pred)) +
geom_point() + theme_bw() + geom_abline(slope = 1) +
theme(axis.text.x = element_text(angle = 45, hjust=1)) +
xlab("Known") + ylab("Predicted") + ggtitle("Tran et. al. 2021") +
xlim(0,1) + ylim(0,1) +
facet_grid(type~cell.type)
plotK2.box.c2 <- ggplot(dfp.c2, aes(x = type, y = error)) +
geom_boxplot(color="cyan") + geom_jitter(alpha = 0.5) + theme_bw() +
theme(axis.text.x = element_text(angle = 45,hjust=1), axis.title.x = element_blank()) +
ylab("Error") + ggtitle("\n") + ylim(0, 0.3) + facet_wrap(~cell.type, nrow = 2)
setwd("..")
setwd("..")
jpeg("./figures/01_multipanel/pseudobulk-k2-2cohort_multi.jpg", width = 10, height = 4, units = "in", res = 400)
layoutMatrix <- matrix(rep(c(1,1,2,3,3,4), 2), byrow=T, nrow=2)
grid.arrange(plotK2.scatter.c1,
plotK2.box.c1,
plotK2.scatter.c2,
plotK2.box.c2,
layout_matrix = layoutMatrix)
dev.off()
libv <- c("here", "nlme", "lute", "ggplot2", "gridExtra",
"dplyr", "ggforce", "MultiAssayExperiment", "SingleCellExperiment")
sapply(libv, library, character.only = TRUE)
knitr::opts_chunk$set(echo = TRUE)
setwd("..")
setwd("..")
list.files()
load("env/01_multipanel/01_pseudobulk_script.RData")
# cohort 1
dfp.c1 <- rbind(data.frame(true = dfp.tall.c1.k3$glial.true,
pred = dfp.tall.c1.k3$glial.pred,
cell.type = rep("glial", nrow(dfp.tall.c1.k3)),
type = dfp.tall.c1.k3$type,
error = dfp.tall.c1.k3$glial.abs.error),
data.frame(true = dfp.tall.c1.k3$Excit.true,
pred = dfp.tall.c1.k3$Excit.pred,
cell.type = rep("Excit", nrow(dfp.tall.c1.k3)),
type = dfp.tall.c1.k3$type,
error = dfp.tall.c1.k3$Excit.abs.error),
data.frame(true = dfp.tall.c1.k3$Inhib.true,
pred = dfp.tall.c1.k3$Inhib.pred,
cell.type = rep("Inhib", nrow(dfp.tall.c1.k3)),
type = dfp.tall.c1.k3$type,
error = dfp.tall.c1.k3$Inhib.abs.error)) |>
as.data.frame()
dfp.c1$cell.type <- factor(dfp.c1$cell.type, levels = c("Excit", "Inhib", "glial"))
plotK3.scatter.c1 <- ggplot(dfp.c1, aes(x = true, y = pred)) +
geom_point() + theme_bw() + geom_abline(slope = 1) +
theme(axis.text.x = element_text(angle = 45, hjust=1)) +
xlab("Known") + ylab("Predicted") + ggtitle("Huuki-Meyers et. al. 2023") +
xlim(0,1) + ylim(0,1) +
facet_wrap(type~cell.type)
plotK3.box.c1 <- ggplot(dfp.c1, aes(x = type, y = error)) +
geom_boxplot(color="cyan") + geom_jitter(alpha = 0.5) + theme_bw() +
theme(axis.text.x = element_text(angle = 45,hjust=1), axis.title.x = element_blank()) +
ylab("Error") + ggtitle("\n") + ylim(0, 0.3) + facet_wrap(~cell.type, nrow = 3)
# cohort 2
dfp.c2 <- rbind(data.frame(true = dfp.tall.c2.k3$glial.true,
pred = dfp.tall.c2.k3$glial.pred,
cell.type = rep("glial", nrow(dfp.tall.c2.k3)),
type = dfp.tall.c2.k3$type,
error = dfp.tall.c2.k3$glial.abs.error),
data.frame(true = dfp.tall.c2.k3$Excit.true,
pred = dfp.tall.c2.k3$Excit.pred,
cell.type = rep("Excit", nrow(dfp.tall.c2.k3)),
type = dfp.tall.c2.k3$type,
error = dfp.tall.c2.k3$Excit.abs.error),
data.frame(true = dfp.tall.c2.k3$Inhib.true,
pred = dfp.tall.c2.k3$Inhib.pred,
cell.type = rep("Inhib", nrow(dfp.tall.c2.k3)),
type = dfp.tall.c2.k3$type,
error = dfp.tall.c2.k3$Inhib.abs.error)) |>
as.data.frame()
dfp.c2$cell.type <- factor(dfp.c2$cell.type, levels = c("Excit", "Inhib", "glial"))
plotK3.scatter.c2 <- ggplot(dfp.c2, aes(x = true, y = pred)) +
geom_point() + theme_bw() + geom_abline(slope = 1) +
theme(axis.text.x = element_text(angle = 45, hjust=1)) +
xlab("Known") + ylab("Predicted") + ggtitle("Tran et. al. 2021") +
xlim(0,1) + ylim(0,1) + facet_wrap(type~cell.type)
plotK3.box.c2 <- ggplot(dfp.c2, aes(x = type, y = error)) +
geom_boxplot(color="cyan") + geom_jitter(alpha = 0.5) + theme_bw() +
theme(axis.text.x = element_text(angle = 45,hjust=1), axis.title.x = element_blank()) +
ylab("Error") + ggtitle("\n") + ylim(0, 0.3) + facet_wrap(~cell.type, nrow = 3)
setwd("..")
setwd("..")
jpeg("./figures/01_multipanel/pseudobulk-k3-2cohort_multi.jpg", width = 10, height = 4, units = "in", res = 400)
layoutMatrix <- matrix(rep(c(1,1,2,3,3,4), 2), byrow=T, nrow=2)
grid.arrange(plotK3.scatter.c1,
plotK3.box.c1,
plotK3.scatter.c2,
plotK3.box.c2,
layout_matrix = layoutMatrix)
dev.off()
# cohort 1
dfp.c1 <- rbind(data.frame(true = dfp.tall.c1.k3$glial.true,
pred = dfp.tall.c1.k3$glial.pred,
cell.type = rep("glial", nrow(dfp.tall.c1.k3)),
type = dfp.tall.c1.k3$type,
error = dfp.tall.c1.k3$glial.abs.error),
data.frame(true = dfp.tall.c1.k3$Excit.true,
pred = dfp.tall.c1.k3$Excit.pred,
cell.type = rep("Excit", nrow(dfp.tall.c1.k3)),
type = dfp.tall.c1.k3$type,
error = dfp.tall.c1.k3$Excit.abs.error),
data.frame(true = dfp.tall.c1.k3$Inhib.true,
pred = dfp.tall.c1.k3$Inhib.pred,
cell.type = rep("Inhib", nrow(dfp.tall.c1.k3)),
type = dfp.tall.c1.k3$type,
error = dfp.tall.c1.k3$Inhib.abs.error)) |>
as.data.frame()
dfp.c1$cell.type <- factor(dfp.c1$cell.type, levels = c("Excit", "Inhib", "glial"))
plotK3.scatter.c1 <- ggplot(dfp.c1, aes(x = true, y = pred)) +
geom_point() + theme_bw() + geom_abline(slope = 1) +
theme(axis.text.x = element_text(angle = 45, hjust=1)) +
xlab("Known") + ylab("Predicted") + ggtitle("Huuki-Meyers et. al. 2023") +
xlim(0,1) + ylim(0,1) +
facet_grid(type~cell.type)
plotK3.box.c1 <- ggplot(dfp.c1, aes(x = type, y = error)) +
geom_boxplot(color="cyan") + geom_jitter(alpha = 0.5) + theme_bw() +
theme(axis.text.x = element_text(angle = 45,hjust=1), axis.title.x = element_blank()) +
ylab("Error") + ggtitle("\n") + ylim(0, 0.3) + facet_wrap(~cell.type, nrow = 3)
plotK3.scatter.c1
ggplot(dfp.c1, aes(x = true, y = pred)) +
geom_point() + theme_bw() + geom_abline(slope = 1) +
theme(axis.text.x = element_text(angle = 45, hjust=1)) +
xlab("Known") + ylab("Predicted") + ggtitle("Huuki-Meyers et. al. 2023") +
xlim(0,1) + ylim(0,1) +
facet_grid(cell.type~type)
# cohort 1
dfp.c1 <- rbind(data.frame(true = dfp.tall.c1.k3$glial.true,
pred = dfp.tall.c1.k3$glial.pred,
cell.type = rep("glial", nrow(dfp.tall.c1.k3)),
type = dfp.tall.c1.k3$type,
error = dfp.tall.c1.k3$glial.abs.error),
data.frame(true = dfp.tall.c1.k3$Excit.true,
pred = dfp.tall.c1.k3$Excit.pred,
cell.type = rep("Excit", nrow(dfp.tall.c1.k3)),
type = dfp.tall.c1.k3$type,
error = dfp.tall.c1.k3$Excit.abs.error),
data.frame(true = dfp.tall.c1.k3$Inhib.true,
pred = dfp.tall.c1.k3$Inhib.pred,
cell.type = rep("Inhib", nrow(dfp.tall.c1.k3)),
type = dfp.tall.c1.k3$type,
error = dfp.tall.c1.k3$Inhib.abs.error)) |>
as.data.frame()
dfp.c1$cell.type <- factor(dfp.c1$cell.type, levels = c("Excit", "Inhib", "glial"))
plotK3.scatter.c1 <- ggplot(dfp.c1, aes(x = true, y = pred)) +
geom_point() + theme_bw() + geom_abline(slope = 1) +
theme(axis.text.x = element_text(angle = 45, hjust=1)) +
xlab("Known") + ylab("Predicted") + ggtitle("Huuki-Meyers et. al. 2023") +
xlim(0,1) + ylim(0,1) +
facet_grid(cell.type~type)
plotK3.box.c1 <- ggplot(dfp.c1, aes(x = type, y = error)) +
geom_boxplot(color="cyan") + geom_jitter(alpha = 0.5) + theme_bw() +
theme(axis.text.x = element_text(angle = 45,hjust=1), axis.title.x = element_blank()) +
ylab("Error") + ggtitle("\n") + ylim(0, 0.3) + facet_wrap(~cell.type, nrow = 3)
# cohort 2
dfp.c2 <- rbind(data.frame(true = dfp.tall.c2.k3$glial.true,
pred = dfp.tall.c2.k3$glial.pred,
cell.type = rep("glial", nrow(dfp.tall.c2.k3)),
type = dfp.tall.c2.k3$type,
error = dfp.tall.c2.k3$glial.abs.error),
data.frame(true = dfp.tall.c2.k3$Excit.true,
pred = dfp.tall.c2.k3$Excit.pred,
cell.type = rep("Excit", nrow(dfp.tall.c2.k3)),
type = dfp.tall.c2.k3$type,
error = dfp.tall.c2.k3$Excit.abs.error),
data.frame(true = dfp.tall.c2.k3$Inhib.true,
pred = dfp.tall.c2.k3$Inhib.pred,
cell.type = rep("Inhib", nrow(dfp.tall.c2.k3)),
type = dfp.tall.c2.k3$type,
error = dfp.tall.c2.k3$Inhib.abs.error)) |>
as.data.frame()
dfp.c2$cell.type <- factor(dfp.c2$cell.type, levels = c("Excit", "Inhib", "glial"))
plotK3.scatter.c2 <- ggplot(dfp.c2, aes(x = true, y = pred)) +
geom_point() + theme_bw() + geom_abline(slope = 1) +
theme(axis.text.x = element_text(angle = 45, hjust=1)) +
xlab("Known") + ylab("Predicted") + ggtitle("Tran et. al. 2021") +
xlim(0,1) + ylim(0,1) + facet_grid(cell.type~type)
plotK3.box.c2 <- ggplot(dfp.c2, aes(x = type, y = error)) +
geom_boxplot(color="cyan") + geom_jitter(alpha = 0.5) + theme_bw() +
theme(axis.text.x = element_text(angle = 45,hjust=1), axis.title.x = element_blank()) +
ylab("Error") + ggtitle("\n") + ylim(0, 0.3) + facet_wrap(~cell.type, nrow = 3)
setwd("..")
setwd("..")
jpeg("./figures/01_multipanel/pseudobulk-k3-2cohort_multi.jpg", width = 10, height = 4, units = "in", res = 400)
layoutMatrix <- matrix(rep(c(1,1,2,3,3,4), 2), byrow=T, nrow=2)
grid.arrange(plotK3.scatter.c1,
plotK3.box.c1,
plotK3.scatter.c2,
plotK3.box.c2,
layout_matrix = layoutMatrix)
dev.off()
