---
title: "RNAscope pseudobulk shuffle final iteration, cohort1"
author: "Sean Maden"
date: "2023-09-03"
output:
  pdf_document: default
  html_document: default
---

This notebook shows a pseudobulk shuffle experiment in which $Z_{pseudobulk}$ is shuffled.

```{r}
knitr::opts_chunk$set(echo = TRUE)
libv <- c("snow", "ggplot2", "dplyr", "parallel", 
          "doParallel", "lute", "dplyr", "scuttle")
sapply(libv, library, character.only = T)
###
point.color <- "limegreen"
###
setwd("..")
setwd("..")
env.name <- "00_fig3ef_script.RData"
env.path <- file.path("env", "03_shuffle", env.name)
load(env.path)
```

# High neuron proportion sample

The $Z_{deconvolution}$ sample has high neuron proportion.

```{r, include = TRUE}
ggplot(dfp.tall.high, 
       aes(x = neuron.true, y = neuron.pred, color = sample.id, size = matched.z)) + 
  geom_point() + geom_abline(slope = 1, intercept = 0) + facet_wrap(~type) +
  ggtitle(paste0("Z pseudobulk id: ", zpb.sample.id.high))
```

Save formatted plot. 

```{r}
new.plot.high <- ggplot(dfp.tall.high, 
       aes(x = neuron.true, y = neuron.pred, shape = matched.z)) + 
  geom_point(size = 5, alpha = 0.5, colour = point.color) + 
  geom_abline(slope = 1, intercept = 0) + facet_wrap(~type) + theme_bw() +
  ggtitle(paste0("Z pseudobulk id: ", zpb.sample.id.high)) + xlim(0.2, 1) + ylim(0.2, 1)
new.plot.high
```

```{r, include = FALSE}

setwd("..")
setwd("..")

new.plot.path <- file.path("figures", "03_shuffle", "fig3e.jpg")

jpeg(new.plot.path, width = 5, height = 3, units = "in", res = 400)

new.plot.high

dev.off()

```

# Low neuron sample

```{r, include = TRUE}
ggplot(dfp.tall.low, 
       aes(x = neuron.true, y = neuron.pred, color = sample.id, size = matched.z)) + 
  geom_point() + geom_abline(slope = 1, intercept = 0) + facet_wrap(~type) +
  ggtitle(paste0("Z pseudobulk id: ", zpb.sample.id.low))
```

Save formatted plot. 

```{r}
new.plot.low <- ggplot(dfp.tall.low, 
       aes(x = neuron.true, y = neuron.pred, shape = matched.z)) + 
  geom_point(size = 5, alpha = 0.5, colour = point.color) + 
  geom_abline(slope = 1, intercept = 0) + facet_wrap(~type) + theme_bw() +
  ggtitle(paste0("Z pseudobulk id: ", zpb.sample.id)) + xlim(0.2, 1) + ylim(0.2, 1)
new.plot.low
```

```{r, include = FALSE}

setwd("..")
setwd("..")

new.plot.path <- file.path("figures", "03_shuffle", "fig3f.jpg")

jpeg(new.plot.path, width = 5, height = 3, units = "in", res = 400)

new.plot.low

dev.off()

```

# Write table


```{r}
setwd("..")
setwd("..")
dfp.tall$shuffle.term <- "Z_pseudobulk"
write.csv(dfp.tall, row.names = F, file = "./outputs/03_shuffle/table_s3_zpb.csv")
```

# Notebook end content

Save environment, session info.

```{r, include = FALSE}
sessionInfo()
```
