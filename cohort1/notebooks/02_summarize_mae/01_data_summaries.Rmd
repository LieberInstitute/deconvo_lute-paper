---
title: "Dataset summaries, sample source IDs"
author: "Sean Maden"
date: "2023-10-13"
output:
  pdf_document: default
  html_document: default
---

Sample source IDs dataset summaries.

```{r setup, include=FALSE}
libv <- c("MultiAssayExperiment", "SummarizedExperiment")
sapply(libv, library, character.only = TRUE)
knitr::opts_chunk$set(echo = TRUE)
setwd("..")
setwd("..")
list.files()
load('./env/02_summarize_mae/01_data_summaries_script.RData')
```

# Inspect tables

Filters comparison

```{r}
df.filter.all
```

# Inspect sample IDs

Pre-filter sample IDs

```{r}
message("all")
unique(mae.all@sampleMap$primary)
message("snrnaseq")
unique(mae.all[[1]][["Sample"]])
message("rnascope")
unique(mae.all[["sce.img"]]$Sample)
```

Post-filter sample IDs.

```{r}
message("all")
unique(mae.filter@sampleMap$primary)
message("snrnaseq")
unique(mae.filter[[1]][["Sample"]])
message("rnascope")
unique(mae.filter[["sce.img"]]$Sample)
```

# Sample summaries plots

## Upset plots

```{r}
mae.upset <- mae.filter[,,c(1,4,6)]
names(mae.upset) <- c("snRNAseq", "bulk RNAseq", "RNAscope")
# training
filter.train <- colData(mae.upset)$sample.id %in% sample.id.train
mae.upset.train <- mae.upset[,filter.train,]
# validation
filter.validate <- colData(mae.upset)$sample.id %in% sample.id.validate
mae.upset.validate <- mae.upset[,filter.validate,]
```

All samples

```{r}
setwd("..")
setwd("..")
jpeg("./figures/02_summarize_mae/figs_upset-mae-all.jpg", 
     width = 4, height = 2.5, units = "in", res = 400)
upsetSamples(mae.upset)
dev.off()
```

Training 

```{r}
setwd("..")
setwd("..")
jpeg("./figures/02_summarize_mae/figs_upset-mae-train.jpg", 
     width = 4, height = 2.5, units = "in", res = 400)
upsetSamples(mae.upset.train)
dev.off()
```

Validation 

```{r}
setwd("..")
setwd("..")
jpeg("./figures/02_summarize_mae/figs_upset-mae-validate.jpg", 
     width = 4, height = 2.5, units = "in", res = 400)
upsetSamples(mae.upset.validate)
dev.off()
```
# Sample quality summaries

```{r}
sample.id.train
```

Bulk

```{r}
bulk <- mae[["bulk.rnaseq"]]

# counts summary
assays(bulk)[["counts"]] |> colSums() |> summary()

# count zeros
apply(assays(bulk)[["counts"]],2,function(ci){length(ci[ci==0])}) |> summary()

length(intersect(bulk$batch.id2, sample.id.train)) 
length(intersect(bulk$batch.id2, sample.id.validate))

bf <- bulk[bulk$library_prep=="Bulk",]
length(intersect(bf$batch.id2, sample.id.train)) 
length(intersect(bf$batch.id2, sample.id.validate))

bf <- bulk[bulk$library_prep=="Cyto",]
length(intersect(bf$batch.id2, sample.id.train)) 
length(intersect(bf$batch.id2, sample.id.validate))

bf <- bulk[bulk$library_prep=="Nuc",]
length(intersect(bf$batch.id2, sample.id.train)) 
length(intersect(bf$batch.id2, sample.id.validate))

bf <- bulk[bulk$library_type=="polyA",]
length(intersect(bf$batch.id2, sample.id.train)) 
length(intersect(bf$batch.id2, sample.id.validate))

bf <- bulk[bulk$library_type=="RiboZeroGold",]
length(intersect(bf$batch.id2, sample.id.train)) 
length(intersect(bf$batch.id2, sample.id.validate))
```

snRNA-seq

```{r}
sce <- rbind(mae[["snrnaseq.k2.all"]], mae[["snrnaseq.k2.all"]])

# counts summary
assays(sce)[["counts"]] |> colSums() |> summary()

# count zeros
apply(assays(bulk)[["counts"]],2,function(ci){length(ci[ci==0])}) |> summary()

```

RNAscope

```{r}
img <- mae[["sce.img"]]
length(unique(img$Sample))
length(intersect(img$Sample, sample.id.train))
length(intersect(img$Sample, sample.id.validate))
```

# Session info

```{r}
sessionInfo()
```

