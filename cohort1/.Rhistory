ggtitle(paste0("S_pseudobulk id :", sample.id.iter.high)) +
facet_wrap(~is.high.consensus)
new.plot.experiment.high
table(is.na(dfp.tall.high$is.high.consensus))
table(dfp.tall.high$is.high.consensus=="NA")
post_dfp_nafilt <- function(dfp, varname){
filter.na.cond <- !is.na(dfp.pre[,varname])
filter.na.cond <- !dfp.pre[,varname]=="NA"
dfp[filter.na.cond,]
}
sample.id.iter.high <- "Br3942_mid"
filter.variable <- "is.high.consensus"
table(is.na(dfp.tall.high$is.high.consensus))
table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, filter.variable)
post_dfp_nafilt <- function(dfp.pre, varname){
filter.na.cond <- !is.na(dfp.pre[,varname])
filter.na.cond <- !dfp.pre[,varname]=="NA"
dfp[filter.na.cond,]
}
sample.id.iter.high <- "Br3942_mid"
filter.variable <- "is.high.consensus"
table(is.na(dfp.tall.high$is.high.consensus))
table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, filter.variable)
dfp.iter
dfp.tall.high
filter.variable
# filter
filter.variable <- "is.high.consensus"
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, filter.variable)
post_dfp_nafilt <- function(dfp.pre, varname){
filter.na.cond <- !is.na(dfp.pre[,varname])
filter.na.cond <- !dfp.pre[,varname]=="NA"
dfp.pre[filter.na.cond,]
}
sample.id.iter.high <- "Br3942_mid"
# filter
filter.variable <- "is.high.consensus"
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, filter.variable)
dfp.iter
new.plot.experiment.high <-
ggplot(dfp.iter,
aes(x = neuron.true, y = neuron.pred, color = sample.id, size = matched.id)) +
geom_point() + geom_abline(slope = 1, intercept = 0) + facet_wrap(~type) +
ggtitle(paste0("S_pseudobulk id :", sample.id.iter.high)) +
facet_wrap(~is.high.consensus)
new.plot.experiment.high
post_dfp_nafilt <- function(dfp.pre, varname){
filter.na.cond <- !is.na(dfp.pre[,varname])
filter.na.cond <- !dfp.pre[,varname]=="NA"
dfp.post <- dfp.pre[filter.na.cond,]
dfp.post[,varname] <- droplevels(dfp.post[,varname])
return(dfp.post)
}
libv <- c("ggplot2")
sapply(libv, library, character.only = TRUE)
knitr::opts_chunk$set(echo = TRUE)
setwd("..")
setwd("..")
load("./env/09_quality/01_run_script.RData")
sample.id.iter.high <- "Br3942_mid"
# filter
filter.variable <- "is.high.consensus"
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, filter.variable)
post_dfp_nafilt <- function(dfp.pre, varname){
filter.na.cond <- !is.na(dfp.pre[,varname])
filter.na.cond <- !dfp.pre[,varname]=="NA"
dfp.post <- dfp.pre[filter.na.cond,]
dfp.post[,varname] <- droplevels(dfp.post[,varname])
dfp.post[,varname] <- as.character(dfp.post[,varname])
return(dfp.post)
}
sample.id.iter.high <- "Br3942_mid"
# filter
filter.variable <- "is.high.consensus"
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, filter.variable)
dfp.tall.high <- list.dfp.tall.append.quality$dfp.tall.high
dfp.tall.low <- list.dfp.tall.append.quality$dfp.tall.low
dfp.tall <- list.dfp.tall.append.quality$dfp.tall
sample.id.iter.high <- "Br3942_mid"
# filter
filter.variable <- "is.high.consensus"
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, filter.variable)
dpf.iter
dfp.iter
libv <- c("ggplot2")
sapply(libv, library, character.only = TRUE)
knitr::opts_chunk$set(echo = TRUE)
setwd("..")
setwd("..")
load("./env/09_quality/01_run_script.RData")
dfp.tall.high <- list.dfp.tall.append.quality$dfp.tall.high
dfp.tall.low <- list.dfp.tall.append.quality$dfp.tall.low
dfp.tall <- list.dfp.tall.append.quality$dfp.tall
post_dfp_nafilt <- function(dfp.pre, varname){
filter.na.cond <- !is.na(dfp.pre[,varname])
filter.na.cond <- !dfp.pre[,varname]=="NA"
dfp.post <- dfp.pre[filter.na.cond,]
dfp.post[,varname] <- droplevels(dfp.post[,varname])
dfp.post[,varname] <- as.character(dfp.post[,varname])
return(dfp.post)
}
sample.id.iter.high <- "Br3942_mid"
# filter
filter.variable <- "is.high.consensus"
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, filter.variable)
sample.id.iter.high <- "Br3942_mid"
# filter
filter.variable <- "is.high.consensus"
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, filter.variable)
class(dfp.tall.high$is.high.consensus)
table(dfp.tall.high$is.high.and.low)
table(dfp.tall.high$is.high.consensus)
v
dfp.iter <- post_dfp_nafilt(dfp.tall.high, filter.variable)
dfp.iter <- post_dfp_nafilt(dfp.tall.high, "is.high.consensus")
dfp.tall.high <- list.dfp.tall.append.quality$dfp.tall.high
dfp.tall.low <- list.dfp.tall.append.quality$dfp.tall.low
dfp.tall <- list.dfp.tall.append.quality$dfp.tall
post_dfp_nafilt <- function(dfp.pre, varname){
filter.na.cond <- !is.na(dfp.pre[,varname])
filter.na.cond <- !dfp.pre[,varname]=="NA"
dfp.post <- dfp.pre[filter.na.cond,]
dfp.post[,varname] <- droplevels(dfp.post[,varname])
dfp.post[,varname] <- as.character(dfp.post[,varname])
return(dfp.post)
}
sample.id.iter.high <- "Br3942_mid"
# filter
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, "is.high.consensus")
post_dfp_nafilt <- function(dfp.pre, varname){
filter.na.cond <- !is.na(dfp.pre[,varname])
filter.na.cond <- !dfp.pre[,varname]=="NA"
dfp.post <- dfp.pre[filter.na.cond,]
tryCatch({dfp.post[,varname] <- droplevels(dfp.post[,varname])})
dfp.post[,varname] <- as.character(dfp.post[,varname])
return(dfp.post)
}
sample.id.iter.high <- "Br3942_mid"
# filter
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, "is.high.consensus")
v
post_dfp_nafilt <- function(dfp.pre, varname){
filter.na.cond <- !is.na(dfp.pre[,varname])
filter.na.cond <- !dfp.pre[,varname]=="NA"
dfp.post <- dfp.pre[filter.na.cond,]
try({dfp.post[,varname] <- droplevels(dfp.post[,varname])})
dfp.post[,varname] <- as.character(dfp.post[,varname])
return(dfp.post)
}
sample.id.iter.high <- "Br3942_mid"
# filter
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, "is.high.consensus")
post_dfp_nafilt <- function(dfp.pre, varname){
filter.na.cond <- !is.na(dfp.pre[,varname])
filter.na.cond <- !dfp.pre[,varname]=="NA"
dfp.post <- dfp.pre[filter.na.cond,]
# try({dfp.post[,varname] <- droplevels(dfp.post[,varname])})
dfp.post[,varname] <- as.character(dfp.post[,varname])
return(dfp.post)
}
sample.id.iter.high <- "Br3942_mid"
# filter
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, "is.high.consensus")
libv <- c("ggplot2")
sapply(libv, library, character.only = TRUE)
knitr::opts_chunk$set(echo = TRUE)
setwd("..")
setwd("..")
load("./env/09_quality/01_run_script.RData")
sample.id.iter.high <- "Br3942_mid"
# filter
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, "is.high.consensus")
sample.id.iter.high <- "Br3942_mid"
# filter
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.iter <- post_dfp_nafilt(dfp.tall.high, "is.high.consensus")
colnames(dfp.tall.high)
gc()
gc()
gc()
#!/usr/bin/env R
# Author: Sean Maden, Stephanie Hicks
#
# RNAscope quality on shuffle experiment status.
#
#
#
#
#
#
source("./source/00_halo_process.R")
#------
# load
#------
load("./data/09_quality/halo_all.Rdata")
load("./env/03_shuffle/00_fig3ab_script.RData")
#----------
# map data
#----------
#
df.conf <- conf_from_halodataobject(halo_all)[[1]]
df.conf.freq <- conf_frequencies(df.conf)
list.dfp.tall <- list(
dfp.tall = dfp.tall,
dfp.tall.high = dfp.tall.high,
dfp.tall.low = dfp.tall.low
)
df.conf.wide <- df.conf.freq$df.combo.wide
list.dfp.tall.append.quality <- lapply(list.dfp.tall, function(item){
dfp.tall.iter <- item
dfp.tall.iter$has.all.slides <-
dfp.tall.iter$is.high.and.low <-
dfp.tall.iter$is.high.and.middle <-
dfp.tall.iter$is.low.and.middle <-
"NA"
dfp.tall.iter$is.high.consensus <-
dfp.tall.iter$is.low.consensus <-
dfp.tall.iter$is.middle.consensus <-
"NA"
for(sample.id in df.conf.wide$sample.id.Circle){
message(sample.id)
df.conf.wide.iter <-
df.conf.wide[df.conf.wide$sample.id.Circle==sample.id,,drop = F]
if(sample.id %in% dfp.tall.iter$sample.id){
iter.filter.condition <- dfp.tall.iter$sample.id==sample.id
dfp.tall.iter[iter.filter.condition,]$has.all.slides <-
df.conf.wide.iter$has.all.slides
dfp.tall.iter[iter.filter.condition,]$is.high.and.low <-
df.conf.wide.iter$is.high.and.low
dfp.tall.iter[iter.filter.condition,]$is.high.and.middle <-
df.conf.wide.iter$is.high.and.middle
dfp.tall.iter[iter.filter.condition,]$is.low.and.middle <-
df.conf.wide.iter$is.low.and.middle
dfp.tall.iter[iter.filter.condition,]$is.high.consensus <-
df.conf.wide.iter$is.high.consensus
dfp.tall.iter[iter.filter.condition,]$is.low.consensus <-
df.conf.wide.iter$is.low.consensus
dfp.tall.iter[iter.filter.condition,]$is.middle.consensus <-
df.conf.wide.iter$is.middle.consensus
}
}
return(dfp.tall.iter)
})
names(list.dfp.tall.append.quality) <- names(list.dfp.tall)
#-----------------
# prep plot data
#------------------
dfp.tall.high <- list.dfp.tall.append.quality$dfp.tall.high
dfp.tall.low <- list.dfp.tall.append.quality$dfp.tall.low
dfp.tall <- list.dfp.tall.append.quality$dfp.tall
post_dfp_nafilt <- function(dfp.pre, varname){
filter.na.cond <- !is.na(dfp.pre[,varname])
filter.na.cond <- !dfp.pre[,varname]=="NA"
dfp.post <- dfp.pre[filter.na.cond,]
# try({dfp.post[,varname] <- droplevels(dfp.post[,varname])})
dfp.post[,varname] <- as.character(dfp.post[,varname])
return(dfp.post)
}
# filter
## table(is.na(dfp.tall.high$is.high.consensus))
## table(dfp.tall.high$is.high.consensus=="NA")
dfp.tall.high <- post_dfp_nafilt(dfp.tall.high, "is.high.consensus")
#---------
# save
#---------
# save image
save.image("./env/09_quality/01_run_script.RData")
dim(dfp.tall.high)
libv <- c("ggplot2")
sapply(libv, library, character.only = TRUE)
knitr::opts_chunk$set(echo = TRUE)
setwd("..")
setwd("..")
load("./env/09_quality/01_run_script.RData")
sample.id.iter.high <- "Br3942_mid"
new.plot.experiment.high <-
ggplot(dfp.tall.high,
aes(x = neuron.true, y = neuron.pred, color = sample.id, size = matched.id)) +
geom_point() + geom_abline(slope = 1, intercept = 0) + facet_wrap(~type) +
ggtitle(paste0("S_pseudobulk id :", sample.id.iter.high)) +
facet_wrap(~is.high.consensus)
new.plot.experiment.high
sample.id.iter.high <- "Br3942_mid"
# DYNAMIC TITLE
varname <- "is.high.consensus"
ggtitle.string <- paste0(
"S_pseudobulk id :", sample.id.iter.high, "; ",
"varname_facet: ", varname
)
# new plot object
new.plot.experiment.high <-
ggplot(dfp.tall.high,
aes(x = neuron.true,
y = neuron.pred,
color = sample.id,
size = matched.id)) +
geom_point() +
geom_abline(slope = 1, intercept = 0) +
facet_wrap(~type) +
ggtitle() +
facet_wrap(~ggtitle.string)
sample.id.iter.high <- "Br3942_mid"
# DYNAMIC TITLE
varname <- "is.high.consensus"
ggtitle.string <- paste0(
"S_pseudobulk id :", sample.id.iter.high, "; ",
"varname_facet: ", varname
)
# new plot object
new.plot.experiment.high <-
ggplot(dfp.tall.high,
aes(x = neuron.true,
y = neuron.pred,
color = sample.id,
size = matched.id)) +
geom_point() +
geom_abline(slope = 1, intercept = 0) +
facet_wrap(~type) +
ggtitle() +
facet_wrap(~is.high.consensus)
table(dfp.tall.high$is.high.consensus)
is.high.consensus
ggtitle.string
# DYNAMIC TITLE
varname <- "is.high.consensus"
plot.title.string <- paste0(
"S_pseudobulk id :", sample.id.iter.high, "; ",
"varname_facet: ", varname
)
plot.title.string
# new plot object
new.plot.experiment.high <-
ggplot(dfp.tall.high,
aes(x = neuron.true,
y = neuron.pred,
color = sample.id,
size = matched.id)) +
geom_point() +
geom_abline(slope = 1, intercept = 0) +
facet_wrap(~type) +
ggtitle() +
facet_wrap(~plot.title.string)
sample.id.iter.high <- "Br3942_mid"
# DYNAMIC TITLE
varname <- "is.high.consensus"
dynamic.title <- paste0(
"S_pseudobulk id :", sample.id.iter.high, "; ",
"varname_facet: ", varname
)
# new plot object
new.plot.experiment.high <-
ggplot(dfp.tall.high,
aes(x = neuron.true,
y = neuron.pred,
color = sample.id,
size = matched.id)) +
geom_point() +
geom_abline(slope = 1, intercept = 0) +
facet_wrap(~type) +
ggtitle(dynamic.title) +
facet_wrap(~plot.title.string)
# evaluate the object, getting plot as side effect
new.plot.experiment.high
sample.id.iter.high <- "Br3942_mid"
# DYNAMIC TITLE
varname <- "is.high.consensus"
dynamic.title <- paste0(
"S_pseudobulk id :", sample.id.iter.high, "; ",
"varname_facet: ", varname
)
# new plot object
new.plot.experiment.high <-
ggplot(dfp.tall.high,
aes(x = neuron.true,
y = neuron.pred,
color = sample.id,
size = matched.id)) +
geom_point() +
geom_abline(slope = 1, intercept = 0) +
facet_wrap(~type) +
ggtitle(dynamic.title) +
facet_wrap(~is.high.consensus)
# evaluate the object, getting plot as side effect
new.plot.experiment.high
colnames(dfp.tall.high)
sample.id.iter.high <- "Br3942_mid"
# DYNAMIC TITLE
varname <- "is.high.consensus"
dynamic.title <- paste0(
"S_pseudobulk id :", sample.id.iter.high, "; ",
"varname_facet: ", varname
)
# new plot object
new.plot.experiment.high <-
ggplot(dfp.tall.high,
aes(x = neuron.true,
y = neuron.pred,
color = sample.id,
size = matched.id)) +
geom_point() +
geom_abline(slope = 1, intercept = 0) +
facet_wrap(~type) +
ggtitle(dynamic.title) +
facet_wrap(~is.high.consensus*type)
# evaluate the object, getting plot as side effect
new.plot.experiment.high
sample.id.iter.high <- "Br3942_mid"
# DYNAMIC TITLE
varname <- "is.high.consensus"
dynamic.title <- paste0(
"S_pseudobulk id :", sample.id.iter.high, "; ",
"varname_facet: ", varname
)
# new plot object
new.plot.experiment.high <-
ggplot(dfp.tall.high,
aes(x = neuron.true,
y = neuron.pred,
color = sample.id,
size = matched.id)) +
geom_point() +
geom_abline(slope = 1, intercept = 0) +
facet_wrap(~type) +
ggtitle(dynamic.title) +
facet_wrap(~is.high.consensus*type, ncol=2)
# evaluate the object, getting plot as side effect
new.plot.experiment.high
table(dfp.tall.high$is.high.consensus)
level(dfp.tall.high$is.high.consensus)
levels(dfp.tall.high$is.high.consensus)
class(dfp.tall.high$is.high.consensus)
table(dfp.tall.high$is.high.consensus)
sample.id.iter.high <- "Br3942_mid"
# DYNAMIC TITLE
varname <- "is.high.consensus"
dynamic.title <- paste0(
"S_pseudobulk id :", sample.id.iter.high, "; ",
"varname_facet: ", varname
)
# new plot object
new.plot.experiment.high <-
ggplot(dfp.tall.high,
aes(x = neuron.true,
y = neuron.pred,
color = sample.id,
size = matched.id)) +
geom_point() +
geom_abline(slope = 1, intercept = 0) +
facet_wrap(~type) +
ggtitle(dynamic.title) +
facet_wrap(~is.high.consensus*type, ncol=2)
# evaluate the object, getting plot as side effect
new.plot.experiment.high
sample.id.iter.high <- "Br3942_mid"
# DYNAMIC TITLE
varname <- "is.high.consensus"
dynamic.title <- paste0(
"S_pseudobulk id :", sample.id.iter.high, "; ",
"varname_facet: ", varname
)
# new plot object
new.plot.experiment.high <-
ggplot(na.omit(dfp.tall.high),
aes(x = neuron.true,
y = neuron.pred,
color = sample.id,
size = matched.id)) +
geom_point() +
geom_abline(slope = 1, intercept = 0) +
facet_wrap(~type) +
ggtitle(dynamic.title) +
facet_wrap(~is.high.consensus*type, ncol=2)
# evaluate the object, getting plot as side effect
new.plot.experiment.high
dim(df.conf.wide)
write.csv(df.conf.wide, file = "./outputs/09_quality/rnascope_quality.csv")
dim(df.conf)
df.conf
df.conf[df.conf$sample.id=="Br8667_mid
",]
df.conf[df.conf$sample.id=="Br8667_mid",]
write.csv(df.conf, file = "./outputs/09_quality/df_conf.csv")
write.csv(df.conf, file = "./outputs/09_quality/df_conf.csv")
write.csv(df.conf, file = "./outputs/09_quality/df_conf.csv", row.names = F)
write.csv(df.conf, file = "./outputs/09_quality/df_conf.csv", row.names = F)
