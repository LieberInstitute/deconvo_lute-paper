setwd("C:/Users/User/Documents/GitHub/cellScaleFactors")
ExperimentHubData::makeExperimentHubMetadata()
BiocManager::install("ExperimentHubData")
ExperimentHubData::makeExperimentHubMetadata()
cd ..
setwd("C:/Users/User/Documents/GitHub")
ExperimentHubData::makeExperimentHubMetadata("cellScaleFactors")
ExperimentHubData::makeExperimentHubMetadata("cellScaleFactors")
ExperimentHubData::makeExperimentHubMetadata("cellScaleFactors")
ExperimentHubData::makeExperimentHubMetadata("cellScaleFactors")
ExperimentHubData::makeExperimentHubMetadata("cellScaleFactors")
ExperimentHubData::makeExperimentHubMetadata("cellScaleFactors")
ExperimentHubData::makeExperimentHubMetadata("cellScaleFactors")
ExperimentHubData::makeExperimentHubMetadata("cellScaleFactors")
ExperimentHubData::makeExperimentHubMetadata("cellScaleFactors")
?.checkValidViews
?AnnotationHubData:::.checkValidViews
getSubTerms(biocViewsVocab, term="Technology")
library(biocViews)
getSubTerms(biocViewsVocab, term="software")
data(biocViewsVocab)
reposPath <- system.file("doc", package="biocViews")
reposUrl <- paste("file://", reposPath, sep="")
biocViews <- getBiocSubViews(reposUrl, biocViewsVocab, topTerm="Software")
biocViews
data(biocViewsVocab)
reposPath <- system.file("doc", package="biocViews")
reposUrl <- paste("file://", reposPath, sep="")
biocViews <- getBiocSubViews(reposUrl, biocViewsVocab, topTerm="ExperimentData")
biocViews
ExperimentHubData::makeExperimentHubMetadata("cellScaleFactors")
ExperimentHubData::makeExperimentHubMetadata("cellScaleFactors")
ExperimentHubData::makeExperimentHubMetadata("cellScaleFactors")
ExperimentHubData::makeExperimentHubMetadata("cellScaleFactors")
setwd("C:/Users/User/Documents/GitHub")
setwd("C:/Users/User/Documents/GitHub/deconvo_method-paper/cohort1")
libv <- c("ggplot2", "reshape2")
sapply(libv, library, character.only = TRUE)
knitr::opts_chunk$set(echo = TRUE)
setwd("..")
setwd("..")
load("./outputs/01_mae/sample_qc_df.rda")
filter.low <- cd.id$confidence.circle=="Low" & cd.id$confidence.star=="Low"
mean(na.omit(as.numeric(cd.id[filter.low,]$size.sn.neuron)))
mean(na.omit(as.numeric(cd.id[!filter.low,]$size.sn.neuron)))
ggplot(cd.id, aes(x = size.sn.neuron, y = size.sn.glial)) +
geom_point() + facet_wrap(~confidence.star)
gc()
libv <- c("ggplot2", "reshape2")
sapply(libv, library, character.only = TRUE)
load("./outputs/01_mae/mae_allsamples_append.rda")
combo.id.variable <- "SAMPLE_ID"
confidence.variable <- "Confidence"
cd.id <- as.data.frame(colData(mae))
for(sample.id in cd.id$sample.id){
message(sample.id)
filter.sample.rnascope <- cd.rnascope$Sample==sample.id
cd.rnascope.iter <- cd.rnascope[filter.sample.rnascope,]
cd.id[cd.id$sample.id==sample.id,]$confidence.circle <- cd.rnascope.iter[cd.rnascope.iter$combo=="CIRCLE",]$Confidence[1]
cd.id[cd.id$sample.id==sample.id,]$confidence.star <- cd.rnascope.iter[cd.rnascope.iter$combo=="STAR",]$Confidence[1]
cell.sizes.iter <- cell.sizes[cell.sizes$sample.id==sample.id,]
filter.glial <- cell.sizes.iter[,2]=="glial"
filter.neuron <- cell.sizes.iter[,2]=="neuron"
cd.id[cd.id$sample.id==sample.id,]$size.sn.glial <- cell.sizes.iter[filter.glial,]$size[1]
cd.id[cd.id$sample.id==sample.id,]$size.sn.neuron <- cell.sizes.iter[filter.neuron,]$size[1]
if(sample.id %in% names(cell.proportions)){
cd.id[cd.id$sample.id==sample.id,]$proportion.sn.glial <- cell.proportions[[sample.id]][["glial"]]
cd.id[cd.id$sample.id==sample.id,]$proportion.sn.neuron <- cell.proportions[[sample.id]][["neuron"]]
}
}
libv <- c("ggplot2", "reshape2")
sapply(libv, library, character.only = TRUE)
load("./outputs/01_mae/mae_allsamples_append.rda")
combo.id.variable <- "SAMPLE_ID"
confidence.variable <- "Confidence"
cd.id <- as.data.frame(colData(mae))
cd.id$confidence.circle <- cd.id$confidence.star <- "NA"
sce.img <- mae[["sce.img"]]
cd.rnascope <- colData(sce.img)
cd.rnascope$combo <- gsub(".*_", "", cd.rnascope$SAMPLE_ID)
table(cd.rnascope$combo)
cell.sizes <- metadata(mae[["snrnaseq.k2.all"]])[["cell.sizes"]]
cell.sizes <- cell.sizes[cell.sizes$ktype=="k2",]
cell.proportions <- metadata(mae[["snrnaseq.k2.all"]])[["list.df.true.k2"]]
cd.id$size.sn.glial <- cd.id$size.sn.neuron <- "NA"
cd.id$proportion.sn.glial <- cd.id$proportion.sn.neuron <- "NA"
for(sample.id in cd.id$sample.id){
message(sample.id)
filter.sample.rnascope <- cd.rnascope$Sample==sample.id
cd.rnascope.iter <- cd.rnascope[filter.sample.rnascope,]
cd.id[cd.id$sample.id==sample.id,]$confidence.circle <- cd.rnascope.iter[cd.rnascope.iter$combo=="CIRCLE",]$Confidence[1]
cd.id[cd.id$sample.id==sample.id,]$confidence.star <- cd.rnascope.iter[cd.rnascope.iter$combo=="STAR",]$Confidence[1]
cell.sizes.iter <- cell.sizes[cell.sizes$sample.id==sample.id,]
filter.glial <- cell.sizes.iter[,2]=="glial"
filter.neuron <- cell.sizes.iter[,2]=="neuron"
cd.id[cd.id$sample.id==sample.id,]$size.sn.glial <- cell.sizes.iter[filter.glial,]$size[1]
cd.id[cd.id$sample.id==sample.id,]$size.sn.neuron <- cell.sizes.iter[filter.neuron,]$size[1]
if(sample.id %in% names(cell.proportions)){
cd.id[cd.id$sample.id==sample.id,]$proportion.sn.glial <- cell.proportions[[sample.id]][["glial"]]
cd.id[cd.id$sample.id==sample.id,]$proportion.sn.neuron <- cell.proportions[[sample.id]][["neuron"]]
}
}
head(cd.id)
class(cd.id)
summary(cd.id)
for(c in c(2,3,4,5,6,7)){cd.id[,c] <- as.numeric(as.character(cd.id[,c]))}
summary(cd.id)
save(cd.id, file = "./outputs/01_mae/sample_qc_df.rda")
libv <- c("ggplot2", "reshape2")
sapply(libv, library, character.only = TRUE)
knitr::opts_chunk$set(echo = TRUE)
setwd("..")
setwd("..")
load("./outputs/01_mae/sample_qc_df.rda")
libv <- c("ggplot2", "reshape2")
sapply(libv, library, character.only = TRUE)
knitr::opts_chunk$set(echo = TRUE)
setwd("..")
setwd("..")
load("./outputs/01_mae/sample_qc_df.rda")
summary(cd.id)
filter.low <- cd.id$confidence.circle=="Low" & cd.id$confidence.star=="Low"
mean(na.omit(as.numeric(cd.id[filter.low,]$size.sn.neuron)))
mean(na.omit(as.numeric(cd.id[!filter.low,]$size.sn.neuron)))
ggplot(cd.id, aes(x = size.sn.neuron, y = size.sn.glial)) +
geom_point() + facet_wrap(~confidence.star)
head(cd.id)
class(cd.id$confidence.star)
cd.id$confidence.star
gc()
libv <- c("ggplot2", "reshape2")
sapply(libv, library, character.only = TRUE)
load("./outputs/01_mae/mae_allsamples_append.rda")
gc()
gc()
gc()
gc()
libv <- c("ggplot2", "reshape2")
sapply(libv, library, character.only = TRUE)
load("./outputs/01_mae/mae_allsamples_append.rda")
setwd("C:/Users/User/Documents/GitHub/deconvo_method-paper/cohort1")
filter.rnascope.confidence <- "Low"
#-----
# load
#-----
mae.in.path <- "./outputs/01_mae/mae_allsamples_append.rda"
mae <- mae.all <- get(load(mae.in.path))
dim(colData(mae))
dim(mae[["cell.sizes"]])
dim(mae.all[["cell.sizes"]])
filter.cell.sizes
filter.cell.sizes
# rnascope confidence annotations
cd.id <- get(load("./outputs/01_mae/sample_qc_df.rda"))
#---------------------------------------------
# 1. filter on rnascope confidence annotations
#---------------------------------------------
sample.vector.keep <- cd.id[cd.id$remove.low==FALSE,]$sample.id
# filter sce.img
sce.img <- mae[["sce.img"]]
dim(sce.img)
filter.sce <- colData(sce.img)$Sample %in% sample.vector.keep
sce.img <- sce.img[,filter.sce]
dim(sce.img)
mae[["sce.img"]] <- sce.img
# filter cell.sizes
cell.sizes <- mae[["cell.sizes"]]
dim(cell.sizes)
filter.cell.sizes <- cell.sizes["sample_id",] %in% sample.vector.keep
cell.sizes <- cell.sizes[,filter.cell.sizes]
dim(cell.sizes)
mae[["cell.sizes"]] <- cell.sizes
dim(mae.all[["cell.sizes"]])
dim(mae[["cell.sizes"]])
dim(mae[["sce.img"]])
dim(mae.all[["sce.img"]])
#!/usr/bin/env R
#
# Preprocess MultiAssayExperiment
#
filter.rnascope.confidence <- "Low"
#-----
# load
#-----
mae.in.path <- "./outputs/01_mae/mae_allsamples_append.rda"
mae <- mae.all <- get(load(mae.in.path))
dim(colData(mae))
# rnascope confidence annotations
cd.id <- get(load("./outputs/01_mae/sample_qc_df.rda"))
#---------------------------------------------
# 1. filter on rnascope confidence annotations
#---------------------------------------------
sample.vector.keep <- cd.id[cd.id$remove.low==FALSE,]$sample.id
# filter sce.img
sce.img <- mae[["sce.img"]]
dim(sce.img)
filter.sce <- colData(sce.img)$Sample %in% sample.vector.keep
sce.img <- sce.img[,filter.sce]
dim(sce.img)
mae[["sce.img"]] <- sce.img
# filter cell.sizes
cell.sizes <- mae[["cell.sizes"]]
dim(cell.sizes)
filter.cell.sizes <- cell.sizes["sample_id",] %in% sample.vector.keep
cell.sizes <- cell.sizes[,filter.cell.sizes]
dim(cell.sizes)
mae[["cell.sizes"]] <- cell.sizes
#-----
# save
#-----
dim(colData(mae))
mae.out.path <- "./outputs/01_mae/mae_analysis_append.rda"
save(mae, file = mae.out.path)
gc()
gc()
gc()
#!/usr/bin/env R
# Author: Sean Maden
#
# Run pseudobulk shuffle experiment varying Sdeconvolution
#
source(file.path("scripts","02_pseudobulk","00_param.R"))
source(file.path("scripts","03_shuffle","00_param.R"))
source(file.path("scripts","03_shuffle","00_param_pseudobulk.R"))
# dependencies
knitr::opts_chunk$set(echo = TRUE)
libv <- c("snow", "dplyr", "parallel", "doParallel", "lute", "dplyr", "scuttle", "MultiAssayExperiment")
sapply(libv, library, character.only = T)
#----------
# load data
#----------
# load mae (SEE CODE 01 OUTPUTS)
mae.filename <- "mae_analysis_append.rda"
mae.path <- file.path("outputs", "01_mae", mae.filename)
mae <- get(load(mae.path))
folder.name <- "03_shuffle"
celltype.variable <- "k2"
sample.id.variable <- "Sample"
assay.name <- "logcounts"
sce <- sce.k2 <- mae[["snrnaseq.k2.all"]]
algorithm.name <- "nnls"
return.dimensions <- "tall"
# load rnascope cell sizes
sample.id.variable.rn <- "sample.id"
df.rn <- mae[["cell.sizes"]]
dfs.rn <- t(df.rn) %>% as.data.frame()
dfs.rn <- dfs.rn[dfs.rn$k.label==celltype.variable,]
dfs.rn <- data.frame(s.glial = dfs.rn[dfs.rn$cell_type=="glial",]$cell_size,
s.neuron = dfs.rn[dfs.rn$cell_type=="neuron",]$cell_size,
sample.id.column = dfs.rn[dfs.rn$cell_type=="neuron",]$sample_id)
colnames(dfs.rn)[3] <- sample.id.variable.rn
for(c in seq(2)){dfs.rn[,c] <- as.numeric(dfs.rn[,c])}
s.data.frame <- dfs.rn
# filter training samples
sample.id.train.path <- file.path("outputs", "00_preprocess", "list_snrnaseq_sampleid.rda")
sample.id.train <- get(load(sample.id.train.path))[["train"]]
sce <- sce[,sce[[sample.id.variable]] %in% sample.id.train]
# subset on rnascope samples
sce <- sce[,sce$Sample %in% dfs.rn$sample.id]
length(intersect(sce$Sample, mae[["cell.sizes"]]))
#-----------------------------------
#
# experiment: high neuron proportion
#
#-----------------------------------
s.scale.sample.id <- s.scale.sample.high <- "Br3942_mid"
dfp.tall <- get_ypb_experiment_series_shuffle(sce.k2,
sample.id.s.scale.shuffle.reference = s.scale.sample.id,
sample.id.variable = sample.id.variable,
celltype.variable = celltype.variable,
assay.name = assay.name,
s.data.frame = s.data.frame,
algorithm.name = algorithm.name,
return.dimensions = return.dimensions)
