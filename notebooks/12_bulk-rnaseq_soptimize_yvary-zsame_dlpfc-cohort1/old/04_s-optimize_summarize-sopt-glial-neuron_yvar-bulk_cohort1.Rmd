---
title: "s-optimize_summarize-sopt-glial-neuron_yvar-bulk_cohort1"
author: "Sean Maden"
date: "2023-08-14"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
libv <- c("ggplot2", "dplyr")
sapply(libv, library, character.only = T)
knitr::opts_chunk$set(echo = TRUE)
```

# Key experiment notes

This notebook shows summaries from SINGLE EXPERIMENT CONDITIONS in the bulk data.

Results summaries from S (cell size scale factor normalization) optimization 
experiments with the following conditions:
* Z is held constant (from a single snRNAseq sample).
* Y is varied (from real RNAseq data)

Important commented text in a code chunk:

```
#--------------------
# Experiment Manifest
#--------------------
IMPORTANT: this is your sample identifier manifest

DATA DICTIONARY
* sample: Brnum, the brain identifier, specific to donor
* position: DLPFC region, anatomic region within DLPFC region, (mid, ant, post)
* cell.compartment: cellular compartment, (nuc, cyto, bulk)
* library.prep: DNA library preparation type (polyA, ribozero)

COLUMN IDENTIFIERS
* base identifer pattern:
[sample.id]-[anatomic.position.id]-[cell.compartment.id]-[library.prep.id]

* primary identifier consolidation
[BLOCK_ID]-[cell.compartment.id]-[library.prep.id]

* secondary identifier consolidation
[BLOCK_ID]-[EXPERIMENT_CONDITION]

```

# Load

```{r}
# load results
setwd("..")
setwd("..")
load.filename <- "list-sopt-values_results-yvar_cohort1.rda"
load.path <- file.path("outputs", "12_soptimize_yvary-zsame_dlpfc-cohort1", load.filename)
results.list <- get(load(load.path))
df.min <- results.list[[2]]

# format group labels
df.min$library.prep <- gsub(".*_", "", df.min$cell.compartment)
df.min$cell.compartment <- gsub("_.*", "", df.min$cell.compartment)
df.min$library.prep.x.cell.compartment <- paste0(df.min$library.prep, ";",df.min$cell.compartment)
```

# Plots -- compare glial vs neuron distributions across groupings

```{r}
dfp <- rbind(data.frame(s.train = df.min$s.glial), data.frame(s.train = df.min$s.neuron))
dfp$cell.type <- c(rep("glial", nrow(df.min)), rep("neuron", nrow(df.min)))
# assign groups
dfp$library.prep <- c(df.min$library.prep, df.min$library.prep)
dfp$cell.compartment <- c(df.min$cell.compartment, df.min$cell.compartment)
dfp$library.prep.x.cell.compartment <- c(df.min$library.prep.x.cell.compartment, df.min$library.prep.x.cell.compartment)
```

```{r}
# violin
ggplot(dfp, aes(x = cell.type, y = s.train)) + geom_violin(draw_quantiles = 0.5)
ggplot(dfp, aes(x = cell.type, y = s.train)) + geom_violin(draw_quantiles = 0.5) + 
  facet_wrap(~library.prep)
ggplot(dfp, aes(x = cell.type, y = s.train)) + geom_violin(draw_quantiles = 0.5) + 
  facet_wrap(~cell.compartment)
ggplot(dfp, aes(x = cell.type, y = s.train)) + geom_violin(draw_quantiles = 0.5) + 
  facet_wrap(~library.prep.x.cell.compartment)
```

```{r}
# boxplot
ggplot(dfp, aes(x = cell.type, y = s.train)) + 
  geom_jitter(alpha = 0.5) + geom_boxplot(color = "cyan", alpha = 0)
ggplot(dfp, aes(x = cell.type, y = s.train)) + 
  geom_jitter(alpha = 0.5) + geom_boxplot(color = "cyan", alpha = 0) +
  facet_wrap(~library.prep)
ggplot(dfp, aes(x = cell.type, y = s.train)) + 
  geom_jitter(alpha = 0.5) + geom_boxplot(color = "cyan", alpha = 0) +
  facet_wrap(~cell.compartment)
ggplot(dfp, aes(x = cell.type, y = s.train)) + 
  geom_jitter(alpha = 0.5) + geom_boxplot(color = "cyan", alpha = 0) +
  facet_wrap(~library.prep.x.cell.compartment)
```

# Plots -- plot S-vs-S, glial-vs-neuron, scatterplot by grouping

```{r}
# scatter
ggplot(df.min, aes(x = s.glial, y = s.neuron)) + geom_point(alpha = 0.5) +
  geom_abline(slope = 1, intercept = 0)
ggplot(df.min, aes(x = s.glial, y = s.neuron)) + geom_point(alpha = 0.5) +
  geom_abline(slope = 1, intercept = 0) + facet_wrap(~cell.compartment)
ggplot(df.min, aes(x = s.glial, y = s.neuron)) + geom_point(alpha = 0.5) +
  geom_abline(slope = 1, intercept = 0) + facet_wrap(~library.prep)
ggplot(df.min, aes(x = s.glial, y = s.neuron)) + geom_point(alpha = 0.5) +
  geom_abline(slope = 1, intercept = 0) + facet_wrap(~library.prep.x.cell.compartment)
```

